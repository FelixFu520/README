# PyTorchç¬”è®°ä¹‹ scatter() å‡½æ•°

âŒšï¸: 2020å¹´8æœˆ9æ—¥

ğŸ“šå‚è€ƒ

---



**scatter()** å’Œ **scatter_()** çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ scatter() ä¸ä¼šç›´æ¥ä¿®æ”¹åŸæ¥çš„ Tensorï¼Œè€Œ scatter_() ä¼š

> PyTorch ä¸­ï¼Œä¸€èˆ¬å‡½æ•°åŠ **ä¸‹åˆ’çº¿**ä»£è¡¨ç›´æ¥åœ¨åŸæ¥çš„ Tensor ä¸Šä¿®æ”¹

scatter(dim, index, src) çš„å‚æ•°æœ‰ 3 ä¸ª

- **dimï¼š**æ²¿ç€å“ªä¸ªç»´åº¦è¿›è¡Œç´¢å¼•
- **indexï¼š**ç”¨æ¥ scatter çš„å…ƒç´ ç´¢å¼•
- **srcï¼š**ç”¨æ¥ scatter çš„æºå…ƒç´ ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ ‡é‡æˆ–ä¸€ä¸ªå¼ é‡

> è¿™ä¸ª scatter å¯ä»¥ç†è§£æˆæ”¾ç½®å…ƒç´ æˆ–è€…ä¿®æ”¹å…ƒç´ 

ç®€å•è¯´å°±æ˜¯é€šè¿‡ä¸€ä¸ªå¼ é‡ src æ¥ä¿®æ”¹å¦ä¸€ä¸ªå¼ é‡ï¼Œå“ªä¸ªå…ƒç´ éœ€è¦ä¿®æ”¹ã€ç”¨ src ä¸­çš„å“ªä¸ªå…ƒç´ æ¥ä¿®æ”¹ç”± dim å’Œ index å†³å®š

å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº† 3ç»´å¼ é‡ çš„å…·ä½“æ“ä½œè¯´æ˜ï¼Œå¦‚ä¸‹æ‰€ç¤º

```
self[index[i][j][k]][j][k] = src[i][j][k]  # if dim == 0
self[i][index[i][j][k]][k] = src[i][j][k]  # if dim == 1
self[i][j][index[i][j][k]] = src[i][j][k]  # if dim == 2
```

**exmapleï¼š**

```
x = torch.rand(2, 5)

#tensor([[0.1940, 0.3340, 0.8184, 0.4269, 0.5945],
#        [0.2078, 0.5978, 0.0074, 0.0943, 0.0266]])

torch.zeros(3, 5).scatter_(0, torch.tensor([[0, 1, 2, 0, 0], [2, 0, 0, 1, 2]]), x)

#tensor([[0.1940, 0.5978, 0.0074, 0.4269, 0.5945],
#        [0.0000, 0.3340, 0.0000, 0.0943, 0.0000],
#        [0.2078, 0.0000, 0.8184, 0.0000, 0.0266]])
```

å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬çš„ index æ˜¯ torch.tensor([[0, 1, 2, 0, 0], [2, 0, 0, 1, 2]])ï¼Œä¸€ä¸ªäºŒç»´å¼ é‡ï¼Œä¸‹é¢ç”¨å›¾ç®€å•è¯´æ˜

æˆ‘ä»¬æ˜¯ 2ç»´ å¼ é‡ï¼Œä¸€å¼€å§‹è¿›è¡Œ `ğ‘ ğ‘’ğ‘™ğ‘“[ğ‘–ğ‘›ğ‘‘ğ‘’ğ‘¥[0][0]][0]`ï¼Œå…¶ä¸­` ğ‘–ğ‘›ğ‘‘ğ‘’ğ‘¥[0][0] `çš„å€¼æ˜¯0ï¼Œæ‰€ä»¥æ‰§è¡Œ `ğ‘ ğ‘’ğ‘™ğ‘“[0][0]=ğ‘¥[0][0]=0.1940 `

> `ğ‘ ğ‘’ğ‘™ğ‘“[ğ‘–ğ‘›ğ‘‘ğ‘’ğ‘¥[ğ‘–][ğ‘—]][ğ‘—]=ğ‘ ğ‘Ÿğ‘[ğ‘–][ğ‘—]`

scatter(dim, index, src)

![img](imgs/1782235-20191126210511653-1936814952.png)

å†æ¯”å¦‚`ğ‘ ğ‘’ğ‘™ğ‘“[ğ‘–ğ‘›ğ‘‘ğ‘’ğ‘¥[1][0]][0]`ï¼Œå…¶ä¸­` ğ‘–ğ‘›ğ‘‘ğ‘’ğ‘¥[1][0] `çš„å€¼æ˜¯2ï¼Œæ‰€ä»¥æ‰§è¡Œ `ğ‘ ğ‘’ğ‘™ğ‘“[2][0]=ğ‘¥[1][0]=0.2078` 

![img](imgs/1782235-20191126211337086-1783407744.png)

**src é™¤äº†å¯ä»¥æ˜¯å¼ é‡å¤–ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ ‡é‡**

**exampleï¼š**

```
torch.zeros(3, 5).scatter_(0, torch.tensor([[0, 1, 2, 0, 0], [2, 0, 0, 1, 2]]), 7)

#tensor([[7., 7., 7., 7., 7.],
#        [0., 7., 0., 7., 0.],
#        [7., 0., 7., 0., 7.]]
```

scatter() **ä¸€èˆ¬å¯ä»¥ç”¨æ¥å¯¹æ ‡ç­¾è¿›è¡Œ one-hot ç¼–ç **ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”¨æ ‡é‡æ¥ä¿®æ”¹å¼ é‡çš„ä¸€ä¸ªä¾‹å­

**exampleï¼š**

```
class_num = 10
batch_size = 4
label = torch.LongTensor(batch_size, 1).random_() % class_num
#tensor([[6],
#        [0],
#        [3],
#        [2]])
torch.zeros(batch_size, class_num).scatter_(1, label, 1)
#tensor([[0., 0., 0., 0., 0., 0., 1., 0., 0., 0.],
#        [1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
#        [0., 0., 0., 1., 0., 0., 0., 0., 0., 0.],
#        [0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]])javascript:void(0))
```





ç”¨æ³•ï¼šoutput=torch.gather(*input*, *dim*, *index)*

```python
a = torch.Tensor([[1,2],[3,4]])
b = torch.gather(a, 1, torch.LongTensor([[0,0],[1,0]]))
print(b) 
```

![image-20210727151159820](imgs/image-20210727151159820.png)