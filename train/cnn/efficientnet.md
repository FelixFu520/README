# EfficientNet

âŒšï¸: 2021-07-21

ğŸ“šå‚è€ƒ

- [EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks](https://paperswithcode.com/paper/efficientnet-rethinking-model-scaling-for)
- [è®ºæ–‡ç¿»è¯‘](https://hellozhaozheng.github.io/z_post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89-EfficientNet-ICML2019/)

- åŸè®ºæ–‡åç§°ï¼šEfficientNet: Rethinking Model Scaling for Convolutional Neural Networks
- åŸè®ºæ–‡æä¾›ä»£ç ï¼šhttps://github.com/tensorflow/tpu/tree/master/models/official/efficientnet
- è‡ªå·±ä½¿ç”¨Pytorchå®ç°çš„ä»£ç ï¼š https://github.com/WZMIAOMIAO/deep-learning-for-image-processing
- ä¸æƒ³çœ‹æ–‡ç« çš„å¯ä»¥çœ‹ä¸‹æˆ‘åœ¨bilibiliä¸Šå½•åˆ¶çš„è§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1XK4y1U7PX

---

## å‰è¨€

åœ¨ä¹‹å‰çš„ä¸€äº›æ‰‹å·¥è®¾è®¡ç½‘ç»œä¸­(AlexNetï¼ŒVGGï¼ŒResNetç­‰ç­‰)ç»å¸¸æœ‰äººé—®ï¼Œä¸ºä»€ä¹ˆè¾“å…¥å›¾åƒåˆ†è¾¨ç‡è¦å›ºå®šä¸º224ï¼Œä¸ºä»€ä¹ˆå·ç§¯çš„ä¸ªæ•°è¦è®¾ç½®ä¸ºè¿™ä¸ªå€¼ï¼Œä¸ºä»€ä¹ˆç½‘ç»œçš„æ·±åº¦è®¾ä¸ºè¿™ä¹ˆæ·±ï¼Ÿè¿™äº›é—®é¢˜ä½ è¦é—®è®¾è®¡ä½œè€…çš„è¯ï¼Œä¼°è®¡å›å¤å°±å››ä¸ªå­—â€”â€”**å·¥ç¨‹ç»éªŒ**ã€‚è€Œè¿™ç¯‡è®ºæ–‡ä¸»è¦æ˜¯ç”¨NASï¼ˆNeural Architecture Searchï¼‰æŠ€æœ¯æ¥æœç´¢ç½‘ç»œçš„å›¾åƒè¾“å…¥åˆ†è¾¨ç‡rï¼Œç½‘ç»œçš„æ·±åº¦ depthä»¥åŠchannelçš„å®½åº¦ widthä¸‰ä¸ªå‚æ•°çš„åˆç†åŒ–é…ç½®ã€‚åœ¨ä¹‹å‰çš„ä¸€äº›è®ºæ–‡ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡æ”¹å˜ä¸Šè¿°3ä¸ªå‚æ•°ä¸­çš„ä¸€ä¸ªæ¥æå‡ç½‘ç»œçš„æ€§èƒ½ï¼Œè€Œè¿™ç¯‡è®ºæ–‡å°±æ˜¯åŒæ—¶æ¥æ¢ç´¢è¿™ä¸‰ä¸ªå‚æ•°çš„å½±å“ã€‚åœ¨è®ºæ–‡ä¸­æåˆ°ï¼Œæœ¬æ–‡æå‡ºçš„EfficientNet-B7åœ¨Imagenet top-1ä¸Šè¾¾åˆ°äº†å½“å¹´æœ€é«˜å‡†ç¡®ç‡84.3%ï¼Œä¸ä¹‹å‰å‡†ç¡®ç‡æœ€é«˜çš„GPipeç›¸æ¯”ï¼Œå‚æ•°æ•°é‡ï¼ˆParamsï¼‰ä»…ä¸ºå…¶1/8.4ï¼Œæ¨ç†é€Ÿåº¦æå‡äº†6.1å€ï¼ˆçœ‹ä¸Šå»åˆå¿«åˆè½»é‡ï¼Œä½†ä¸ªäººå®é™…ä½¿ç”¨èµ·æ¥å‘ç°å¾ˆåƒæ˜¾å­˜ï¼‰ã€‚ä¸‹å›¾æ˜¯EfficientNetä¸å…¶ä»–ç½‘ç»œçš„å¯¹æ¯”ï¼ˆæ³¨æ„ï¼Œå‚æ•°æ•°é‡å°‘å¹¶ä¸æ„å‘³æ¨ç†é€Ÿåº¦å°±å¿«ï¼‰ã€‚

![image-20210726192703199](imgs/image-20210726192703199.png)



## è®ºæ–‡æ€æƒ³

åœ¨ä¹‹å‰çš„ä¸€äº›è®ºæ–‡ä¸­ï¼Œæœ‰çš„ä¼šé€šè¿‡å¢åŠ ç½‘ç»œçš„widthå³å¢åŠ å·ç§¯æ ¸çš„ä¸ªæ•°ï¼ˆå¢åŠ ç‰¹å¾çŸ©é˜µçš„channelsï¼‰æ¥æå‡ç½‘ç»œçš„æ€§èƒ½å¦‚å›¾(b)æ‰€ç¤ºï¼Œæœ‰çš„ä¼šé€šè¿‡å¢åŠ ç½‘ç»œçš„æ·±åº¦å³ä½¿ç”¨æ›´å¤šçš„å±‚ç»“æ„æ¥æå‡ç½‘ç»œçš„æ€§èƒ½å¦‚å›¾(c)æ‰€ç¤ºï¼Œæœ‰çš„ä¼šé€šè¿‡å¢åŠ è¾“å…¥ç½‘ç»œçš„åˆ†è¾¨ç‡æ¥æå‡ç½‘ç»œçš„æ€§èƒ½å¦‚å›¾(d)æ‰€ç¤ºã€‚è€Œåœ¨æœ¬ç¯‡è®ºæ–‡ä¸­ä¼šåŒæ—¶å¢åŠ ç½‘ç»œçš„widthã€ç½‘ç»œçš„æ·±åº¦ä»¥åŠè¾“å…¥ç½‘ç»œçš„åˆ†è¾¨ç‡æ¥æå‡ç½‘ç»œçš„æ€§èƒ½å¦‚å›¾(e)æ‰€ç¤ºï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](imgs/123.png)



- æ ¹æ®ä»¥å¾€çš„ç»éªŒï¼Œå¢åŠ ç½‘ç»œçš„æ·±åº¦depthèƒ½å¤Ÿå¾—åˆ°æ›´åŠ ä¸°å¯Œã€å¤æ‚çš„ç‰¹å¾å¹¶ä¸”èƒ½å¤Ÿå¾ˆå¥½çš„åº”ç”¨åˆ°å…¶å®ƒä»»åŠ¡ä¸­ã€‚ä½†ç½‘ç»œçš„æ·±åº¦è¿‡æ·±ä¼šé¢ä¸´æ¢¯åº¦æ¶ˆå¤±ï¼Œè®­ç»ƒå›°éš¾çš„é—®é¢˜ã€‚The intuition is that deeper ConvNet can capture richer and more complex features, and generalize well on new tasks. However, deeper networks are also more difficult to train due to the vanishing gradient problem
- å¢åŠ ç½‘ç»œçš„widthèƒ½å¤Ÿè·å¾—æ›´é«˜ç»†ç²’åº¦çš„ç‰¹å¾å¹¶ä¸”ä¹Ÿæ›´å®¹æ˜“è®­ç»ƒï¼Œä½†å¯¹äºwidthå¾ˆå¤§è€Œæ·±åº¦è¾ƒæµ…çš„ç½‘ç»œå¾€å¾€å¾ˆéš¾å­¦ä¹ åˆ°æ›´æ·±å±‚æ¬¡çš„ç‰¹å¾ã€‚wider networks tend to be able to capture more fine-grained features and are easier to train. However, extremely wide but shallow networks tend to have difficulties in capturing higher level features.

- å¢åŠ è¾“å…¥ç½‘ç»œçš„å›¾åƒåˆ†è¾¨ç‡èƒ½å¤Ÿæ½œåœ¨å¾—è·å¾—æ›´é«˜ç»†ç²’åº¦çš„ç‰¹å¾æ¨¡æ¿ï¼Œä½†å¯¹äºéå¸¸é«˜çš„è¾“å…¥åˆ†è¾¨ç‡ï¼Œå‡†ç¡®ç‡çš„å¢ç›Šä¹Ÿä¼šå‡å°ã€‚å¹¶ä¸”å¤§åˆ†è¾¨ç‡å›¾åƒä¼šå¢åŠ è®¡ç®—é‡ã€‚With higher resolution input images, ConvNets can potentially capture more fine-grained patterns. but the accuracy gain diminishes for very high resolutions.

ä¸‹å›¾å±•ç¤ºäº†åœ¨åŸºå‡†EfficientNetB-0ä¸Šåˆ†åˆ«å¢åŠ widthã€depthä»¥åŠresolutionåå¾—åˆ°çš„ç»Ÿè®¡ç»“æœã€‚é€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹å‡ºå¤§æ¦‚åœ¨Accuracyè¾¾åˆ°80%æ—¶å°±è¶‹äºé¥±å’Œäº†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](imgs/456.png)



æ¥ç€ä½œè€…åˆåšäº†ä¸€ä¸ªå®éªŒï¼Œé‡‡ç”¨ä¸åŒçš„d , rç»„åˆï¼Œç„¶åä¸æ–­æ”¹å˜ç½‘ç»œçš„widthå°±å¾—åˆ°äº†å¦‚ä¸‹å›¾æ‰€ç¤ºçš„4æ¡æ›²çº¿ï¼Œé€šè¿‡åˆ†æå¯ä»¥å‘ç°åœ¨ç›¸åŒçš„FLOPsä¸‹ï¼ŒåŒæ—¶å¢åŠ då’Œr çš„æ•ˆæœæœ€å¥½ã€‚

![image-20210726194245590](imgs/image-20210726194245590.png)

![image-20210726194320573](imgs/image-20210726194320573.png)

![image-20210726194442393](imgs/image-20210726194442393.png)

![image-20210726194536073](imgs/image-20210726194536073.png)





![image-20210726194630440](imgs/image-20210726194630440.png)



## ç½‘ç»œè¯¦ç»†ç»“æ„

ä¸‹è¡¨ä¸ºEfficientNet-B0çš„ç½‘ç»œæ¡†æ¶ï¼ˆB1-B7å°±æ˜¯åœ¨B0çš„åŸºç¡€ä¸Šä¿®æ”¹Resolutionï¼ŒChannelsä»¥åŠLayersï¼‰ï¼Œå¯ä»¥çœ‹å‡ºç½‘ç»œæ€»å…±åˆ†æˆäº†9ä¸ªStageï¼Œç¬¬ä¸€ä¸ªStageå°±æ˜¯ä¸€ä¸ªå·ç§¯æ ¸å¤§å°ä¸º3x3æ­¥è·ä¸º2çš„æ™®é€šå·ç§¯å±‚ï¼ˆåŒ…å«BNå’Œæ¿€æ´»å‡½æ•°Swishï¼‰ï¼ŒStage2ï½Stage8éƒ½æ˜¯åœ¨é‡å¤å †å MBConvç»“æ„ï¼ˆæœ€åä¸€åˆ—çš„Layersè¡¨ç¤ºè¯¥Stageé‡å¤MBConvç»“æ„å¤šå°‘æ¬¡ï¼‰ï¼Œè€ŒStage9ç”±ä¸€ä¸ªæ™®é€šçš„1x1çš„å·ç§¯å±‚ï¼ˆåŒ…å«BNå’Œæ¿€æ´»å‡½æ•°Swishï¼‰ä¸€ä¸ªå¹³å‡æ± åŒ–å±‚å’Œä¸€ä¸ªå…¨è¿æ¥å±‚ç»„æˆã€‚è¡¨æ ¼ä¸­æ¯ä¸ªMBConvåä¼šè·Ÿä¸€ä¸ªæ•°å­—1æˆ–6ï¼Œè¿™é‡Œçš„1æˆ–6å°±æ˜¯å€ç‡å› å­nå³MBConvä¸­ç¬¬ä¸€ä¸ª1x1çš„å·ç§¯å±‚ä¼šå°†è¾“å…¥ç‰¹å¾çŸ©é˜µçš„channelsæ‰©å……ä¸ºnå€ï¼Œå…¶ä¸­k3x3æˆ–k5x5è¡¨ç¤ºMBConvä¸­Depthwise Convæ‰€é‡‡ç”¨çš„å·ç§¯æ ¸å¤§å°ã€‚Channelsè¡¨ç¤ºé€šè¿‡è¯¥Stageåè¾“å‡ºç‰¹å¾çŸ©é˜µçš„Channelsã€‚

![img](imgs/asdfdasdf.png)



## MBConvç»“æ„

MBConvå…¶å®å°±æ˜¯MobileNetV3ç½‘ç»œä¸­çš„InvertedResidualBlockï¼Œä½†ä¹Ÿæœ‰äº›è®¸åŒºåˆ«ã€‚ä¸€ä¸ªæ˜¯é‡‡ç”¨çš„æ¿€æ´»å‡½æ•°ä¸ä¸€æ ·ï¼ˆEfficientNetçš„MBConvä¸­ä½¿ç”¨çš„éƒ½æ˜¯Swishæ¿€æ´»å‡½æ•°ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨æ¯ä¸ªMBConvä¸­éƒ½åŠ å…¥äº†SEï¼ˆSqueeze-and-Excitationï¼‰æ¨¡å—ã€‚ä¸‹å›¾æ˜¯æˆ‘è‡ªå·±ç»˜åˆ¶çš„MBConvç»“æ„ã€‚



![image-20210726194834499](imgs/image-20210726194834499.png)

![img](imgs/zxcvxzc.png)



## EfficientNet(B0-B7)å‚æ•°

è¿˜æ˜¯å…ˆç»™å‡ºEfficientNetB0çš„ç½‘ç»œç»“æ„ï¼Œæ–¹ä¾¿åé¢ç†è§£ã€‚

![img](imgs/asdfdasdf.png)

![image-20210726195034508](imgs/image-20210726195034508.png)

![image-20210726195107705](imgs/image-20210726195107705.png)