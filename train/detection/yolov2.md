# YOLOv2ï¼ˆYOLO9000ï¼‰

âŒšï¸: 2020å¹´8æœˆ9æ—¥

ğŸ“šå‚è€ƒ

- **è®ºæ–‡åœ°å€ï¼š**[https://arxiv.org/abs/1612.08242](https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1612.08242)
- [ã€è®ºæ–‡è§£è¯»ã€‘Yoloä¸‰éƒ¨æ›²è§£è¯»â€”â€”Yolov2](https://zhuanlan.zhihu.com/p/74540100)
- [object detection. YOLOv2](https://www.cnblogs.com/shouhuxianjian/p/7411593.html)
- [YOLOv2ç›®æ ‡æ£€æµ‹è¯¦è§£](https://blog.csdn.net/mieleizhi0522/article/details/79887066)

---



## 1. Yolov2/Yolo900æ¦‚è¿°

![img](imgs/001.jpg)





å›¾ä¸€ Yolo9000æ£€æµ‹æ•ˆæœå›¾

å…ˆè§£é‡Šæ¦‚å¿µï¼šYolov2å’ŒYolo9000ç®—æ³•å†…æ ¸ç›¸åŒï¼ŒåŒºåˆ«æ˜¯è®­ç»ƒæ–¹å¼ä¸åŒï¼šYolov2ç”¨cocoæ•°æ®é›†è®­ç»ƒåï¼Œå¯ä»¥è¯†åˆ«80ä¸ªç§ç±»ã€‚è€ŒYolo9000å¯ä»¥ä½¿ç”¨cocoæ•°æ®é›† + ImageNetæ•°æ®é›†è”åˆè®­ç»ƒï¼Œå¯ä»¥è¯†åˆ«9000å¤šä¸ªç§ç±»ã€‚å›¾ä¸€ä¸ºYolo9000çš„æ£€æµ‹æ•ˆæœå›¾ï¼Œå¯ä»¥çœ‹åˆ°å›¾ç‰‡ä¸­çš„äººï¼Œè¢«åˆ†ä¸ºäº†leaderã€Americanã€skin-diverã€athleteã€‚

æœ¬æ–‡é¦–å…ˆä»‹ç»Yolov2ï¼Œåˆ—ä¸¾å‡ºåŸºäºv1æ‰€åšçš„æ”¹è¿›ï¼›ä¹‹åè§£è¯»Yolo9000çš„è®­ç»ƒæ–¹æ³•ã€‚



YOLOv2ç›¸å¯¹v1ç‰ˆæœ¬ï¼Œåœ¨ç»§ç»­ä¿æŒå¤„ç†é€Ÿåº¦çš„åŸºç¡€ä¸Šï¼Œä»é¢„æµ‹**æ›´å‡†ç¡®ï¼ˆBetterï¼‰**ï¼Œ**é€Ÿåº¦æ›´å¿«ï¼ˆFasterï¼‰**ï¼Œ**è¯†åˆ«å¯¹è±¡æ›´å¤šï¼ˆStrongerï¼‰**è¿™ä¸‰ä¸ªæ–¹é¢è¿›è¡Œäº†æ”¹è¿›ã€‚å…¶ä¸­è¯†åˆ«æ›´å¤šå¯¹è±¡ä¹Ÿå°±æ˜¯æ‰©å±•åˆ°èƒ½å¤Ÿæ£€æµ‹9000ç§ä¸åŒå¯¹è±¡ï¼Œç§°ä¹‹ä¸º**YOLO9000**ã€‚

æ–‡ç« æå‡ºäº†ä¸€ç§æ–°çš„**è®­ç»ƒæ–¹æ³•â€“è”åˆè®­ç»ƒç®—æ³•**ï¼Œè¿™ç§ç®—æ³•å¯ä»¥æŠŠè¿™ä¸¤ç§çš„æ•°æ®é›†æ··åˆåˆ°ä¸€èµ·ã€‚ä½¿ç”¨ä¸€ç§åˆ†å±‚çš„è§‚ç‚¹å¯¹ç‰©ä½“è¿›è¡Œåˆ†ç±»ï¼Œç”¨å·¨é‡çš„**åˆ†ç±»æ•°æ®é›†æ•°æ®æ¥æ‰©å……æ£€æµ‹æ•°æ®é›†**ï¼Œä»è€ŒæŠŠä¸¤ç§ä¸åŒçš„æ•°æ®é›†æ··åˆèµ·æ¥ã€‚

è”åˆè®­ç»ƒç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šåŒæ—¶åœ¨æ£€æµ‹æ•°æ®é›†å’Œåˆ†ç±»æ•°æ®é›†ä¸Šè®­ç»ƒç‰©ä½“æ£€æµ‹å™¨ï¼ˆObject Detectors ï¼‰ï¼Œ**ç”¨æ£€æµ‹æ•°æ®é›†çš„æ•°æ®å­¦ä¹ ç‰©ä½“çš„å‡†ç¡®ä½ç½®ï¼Œç”¨åˆ†ç±»æ•°æ®é›†çš„æ•°æ®æ¥å¢åŠ åˆ†ç±»çš„ç±»åˆ«é‡ã€æå‡å¥å£®æ€§ã€‚**

YOLO9000å°±æ˜¯ä½¿ç”¨è”åˆè®­ç»ƒç®—æ³•è®­ç»ƒå‡ºæ¥çš„ï¼Œä»–æ‹¥æœ‰9000ç±»çš„åˆ†ç±»ä¿¡æ¯ï¼Œè¿™äº›åˆ†ç±»ä¿¡æ¯å­¦ä¹ è‡ªImageNetåˆ†ç±»æ•°æ®é›†ï¼Œè€Œç‰©ä½“ä½ç½®æ£€æµ‹åˆ™å­¦ä¹ è‡ªCOCOæ£€æµ‹æ•°æ®é›†



## 2. Yolov2ï¼ˆBetterï¼ŒFasterï¼‰

![img](imgs/v2-023694d91a0e3c3bcd1c9fe131c416d9_720w.png)

![image-20200930144020160](imgs/image-20200930144020160.png)

YOLOv2ç›¸æ¯”YOLOv1çš„æ”¹è¿›ç­–ç•¥

**---------------Better---------------**

### 2.1 **Batch Normalizationï¼ˆæ‰¹é‡å½’ä¸€åŒ–ï¼‰**

> By adding batch normalization on all of the convolutional layers in YOLO we get more than 2% improvement in mAP.

mAPæå‡2.4%ã€‚

æ‰¹å½’ä¸€åŒ–æœ‰åŠ©äºè§£å†³åå‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œé™ä½å¯¹ä¸€äº›è¶…å‚æ•°ï¼ˆæ¯”å¦‚å­¦ä¹ ç‡ã€ç½‘ç»œå‚æ•°çš„å¤§å°èŒƒå›´ã€æ¿€æ´»å‡½æ•°çš„é€‰æ‹©ï¼‰çš„æ•æ„Ÿæ€§ï¼Œå¹¶ä¸”æ¯ä¸ªbatchåˆ†åˆ«è¿›è¡Œå½’ä¸€åŒ–çš„æ—¶å€™ï¼Œèµ·åˆ°äº†ä¸€å®šçš„æ­£åˆ™åŒ–æ•ˆæœï¼ˆYOLO2ä¸å†ä½¿ç”¨dropoutï¼‰ï¼Œä»è€Œèƒ½å¤Ÿè·å¾—æ›´å¥½çš„æ”¶æ•›é€Ÿåº¦å’Œæ”¶æ•›æ•ˆæœã€‚

é€šå¸¸ï¼Œä¸€æ¬¡è®­ç»ƒä¼šè¾“å…¥ä¸€æ‰¹æ ·æœ¬ï¼ˆbatchï¼‰è¿›å…¥ç¥ç»ç½‘ç»œã€‚æ‰¹è§„ä¸€åŒ–åœ¨ç¥ç»ç½‘ç»œçš„æ¯ä¸€å±‚ï¼Œåœ¨ç½‘ç»œï¼ˆçº¿æ€§å˜æ¢ï¼‰è¾“å‡ºåå’Œæ¿€æ´»å‡½æ•°ï¼ˆéçº¿æ€§å˜æ¢ï¼‰ä¹‹å‰å¢åŠ ä¸€ä¸ªæ‰¹å½’ä¸€åŒ–å±‚ï¼ˆBNï¼‰ï¼ŒBNå±‚è¿›è¡Œå¦‚ä¸‹å˜æ¢ï¼šâ‘ å¯¹è¯¥æ‰¹æ ·æœ¬çš„å„ç‰¹å¾é‡ï¼ˆå¯¹äºä¸­é—´å±‚æ¥è¯´ï¼Œå°±æ˜¯æ¯ä¸€ä¸ªç¥ç»å…ƒï¼‰åˆ†åˆ«è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œåˆ†åˆ«ä½¿æ¯ä¸ªç‰¹å¾çš„æ•°æ®åˆ†å¸ƒå˜æ¢ä¸ºå‡å€¼0ï¼Œæ–¹å·®1ã€‚ä»è€Œä½¿å¾—æ¯ä¸€æ‰¹è®­ç»ƒæ ·æœ¬åœ¨æ¯ä¸€å±‚éƒ½æœ‰ç±»ä¼¼çš„åˆ†å¸ƒã€‚è¿™ä¸€å˜æ¢ä¸éœ€è¦å¼•å…¥é¢å¤–çš„å‚æ•°ã€‚â‘¡å¯¹ä¸Šä¸€æ­¥çš„è¾“å‡ºå†åšä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œå‡è®¾ä¸Šä¸€æ­¥çš„è¾“å‡ºä¸ºZï¼Œåˆ™Z1=Î³Z + Î²ã€‚è¿™é‡ŒÎ³ã€Î²æ˜¯å¯ä»¥è®­ç»ƒçš„å‚æ•°ã€‚å¢åŠ è¿™ä¸€å˜æ¢æ˜¯å› ä¸ºä¸Šä¸€æ­¥éª¤ä¸­å¼ºåˆ¶æ”¹å˜äº†ç‰¹å¾æ•°æ®çš„åˆ†å¸ƒï¼Œå¯èƒ½å½±å“äº†åŸæœ‰æ•°æ®çš„ä¿¡æ¯è¡¨è¾¾èƒ½åŠ›ã€‚å¢åŠ çš„çº¿æ€§å˜æ¢ä½¿å…¶æœ‰æœºä¼šæ¢å¤å…¶åŸæœ¬çš„ä¿¡æ¯ã€‚



### **2.2 High resolution classifierï¼ˆé«˜åˆ†è¾¨ç‡å›¾åƒåˆ†ç±»å™¨ï¼‰**

> åˆ†ç±»ç½‘ç»œé«˜åˆ†è¾¨ç‡é¢„è®­ç»ƒ

mAPæå‡äº†3.7%ã€‚

å›¾åƒåˆ†ç±»çš„è®­ç»ƒæ ·æœ¬å¾ˆå¤šï¼Œè€Œæ ‡æ³¨äº†è¾¹æ¡†çš„ç”¨äºè®­ç»ƒå¯¹è±¡æ£€æµ‹çš„æ ·æœ¬ç›¸æ¯”è€Œè¨€å°±æ¯”è¾ƒå°‘äº†ï¼Œå› ä¸ºæ ‡æ³¨è¾¹æ¡†çš„äººå·¥æˆæœ¬æ¯”è¾ƒé«˜ã€‚æ‰€ä»¥å¯¹è±¡æ£€æµ‹æ¨¡å‹é€šå¸¸éƒ½å…ˆç”¨å›¾åƒåˆ†ç±»æ ·æœ¬è®­ç»ƒå·ç§¯å±‚ï¼Œæå–å›¾åƒç‰¹å¾ã€‚ä½†è¿™å¼•å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå›¾åƒåˆ†ç±»æ ·æœ¬çš„åˆ†è¾¨ç‡ä¸æ˜¯å¾ˆé«˜ã€‚æ‰€ä»¥YOLO v1ä½¿ç”¨ImageNetçš„å›¾åƒåˆ†ç±»æ ·æœ¬é‡‡ç”¨ 224\*224 ä½œä¸ºè¾“å…¥ï¼Œæ¥è®­ç»ƒCNNå·ç§¯å±‚ã€‚ç„¶ååœ¨è®­ç»ƒå¯¹è±¡æ£€æµ‹æ—¶ï¼Œæ£€æµ‹ç”¨çš„å›¾åƒæ ·æœ¬é‡‡ç”¨æ›´é«˜åˆ†è¾¨ç‡çš„ 448\*448 çš„å›¾åƒä½œä¸ºè¾“å…¥ã€‚ä½†è¿™æ ·åˆ‡æ¢å¯¹æ¨¡å‹æ€§èƒ½æœ‰ä¸€å®šå½±å“ã€‚

**æ‰€ä»¥YOLO2åœ¨é‡‡ç”¨ 224\*224 å›¾åƒè¿›è¡Œåˆ†ç±»æ¨¡å‹é¢„è®­ç»ƒåï¼Œå†é‡‡ç”¨ 448\*448 çš„é«˜åˆ†è¾¨ç‡æ ·æœ¬å¯¹åˆ†ç±»æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ˆ10ä¸ªepochï¼‰**ï¼Œä½¿ç½‘ç»œç‰¹å¾é€æ¸é€‚åº” 448\*448 çš„åˆ†è¾¨ç‡ã€‚ç„¶åå†ä½¿ç”¨ 448\*448 çš„æ£€æµ‹æ ·æœ¬è¿›è¡Œè®­ç»ƒï¼Œç¼“è§£äº†åˆ†è¾¨ç‡çªç„¶åˆ‡æ¢é€ æˆçš„å½±å“ã€‚

### **2.3 Convolution with anchor boxesï¼ˆä½¿ç”¨å…ˆéªŒæ¡†ï¼‰**

> Anchor Boxæ›¿æ¢å…¨è¿æ¥å±‚

å¬å›ç‡å¤§å¹…æå‡åˆ°88%ï¼ŒåŒæ—¶mAPè½»å¾®ä¸‹é™äº†0.2ã€‚

YOLOV1åŒ…å«æœ‰å…¨è¿æ¥å±‚ï¼Œä»è€Œèƒ½ç›´æ¥é¢„æµ‹Bounding Boxesçš„åæ ‡å€¼ã€‚ Faster R-CNNçš„æ–¹æ³•åªç”¨å·ç§¯å±‚ä¸Region Proposal Networkæ¥é¢„æµ‹Anchor Boxçš„åç§»å€¼ä¸ç½®ä¿¡åº¦ï¼Œè€Œä¸æ˜¯ç›´æ¥é¢„æµ‹åæ ‡å€¼ã€‚ä½œè€…å‘ç°é€šè¿‡é¢„æµ‹åç§»é‡è€Œä¸æ˜¯åæ ‡å€¼èƒ½å¤Ÿç®€åŒ–é—®é¢˜ï¼Œè®©ç¥ç»ç½‘ç»œå­¦ä¹ èµ·æ¥æ›´å®¹æ˜“ã€‚

å€Ÿé‰´Faster RCNNçš„åšæ³•ï¼Œ**YOLO2ä¹Ÿå°è¯•é‡‡ç”¨å…ˆéªŒæ¡†ï¼ˆanchorï¼‰ã€‚åœ¨æ¯ä¸ªgridé¢„å…ˆè®¾å®šä¸€ç»„ä¸åŒå¤§å°å’Œå®½é«˜æ¯”çš„è¾¹æ¡†ï¼Œæ¥è¦†ç›–æ•´ä¸ªå›¾åƒçš„ä¸åŒä½ç½®å’Œå¤šç§å°ºåº¦**ï¼Œè¿™äº›å…ˆéªŒæ¡†ä½œä¸ºé¢„å®šä¹‰çš„å€™é€‰åŒºåœ¨ç¥ç»ç½‘ç»œä¸­å°†æ£€æµ‹å…¶ä¸­æ˜¯å¦å­˜åœ¨å¯¹è±¡ï¼Œä»¥åŠå¾®è°ƒè¾¹æ¡†çš„ä½ç½®ã€‚

ä¹‹å‰YOLO1å¹¶æ²¡æœ‰é‡‡ç”¨å…ˆéªŒæ¡†ï¼Œå¹¶ä¸”æ¯ä¸ªgridåªé¢„æµ‹ä¸¤ä¸ªbounding boxï¼Œæ•´ä¸ªå›¾åƒ98ä¸ªã€‚YOLO2å¦‚æœæ¯ä¸ªgridé‡‡ç”¨9ä¸ªå…ˆéªŒæ¡†ï¼Œæ€»å…±æœ‰13\*13\*9=1521ä¸ªå…ˆéªŒæ¡†ã€‚æ‰€ä»¥æœ€ç»ˆYOLOå»æ‰äº†å…¨è¿æ¥å±‚ï¼Œä½¿ç”¨Anchor Boxesæ¥é¢„æµ‹ Bounding Boxesã€‚ä½œè€…å»æ‰äº†ç½‘ç»œä¸­ä¸€ä¸ªPoolingå±‚ï¼Œè¿™è®©å·ç§¯å±‚çš„è¾“å‡ºèƒ½æœ‰æ›´é«˜çš„åˆ†è¾¨ç‡ã€‚æ”¶ç¼©ç½‘ç»œè®©å…¶è¿è¡Œåœ¨416\*416è€Œä¸æ˜¯448\*448ã€‚

ç”±äºå›¾ç‰‡ä¸­çš„ç‰©ä½“éƒ½å€¾å‘äºå‡ºç°åœ¨å›¾ç‰‡çš„ä¸­å¿ƒä½ç½®ï¼Œç‰¹åˆ«æ˜¯é‚£ç§æ¯”è¾ƒå¤§çš„ç‰©ä½“ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå•ç‹¬ä½äºç‰©ä½“ä¸­å¿ƒçš„ä½ç½®ç”¨äºé¢„æµ‹è¿™äº›ç‰©ä½“ã€‚YOLOçš„å·ç§¯å±‚é‡‡ç”¨32è¿™ä¸ªå€¼æ¥ä¸‹é‡‡æ ·å›¾ç‰‡ï¼Œæ‰€ä»¥é€šè¿‡é€‰æ‹©416\*416ç”¨ä½œè¾“å…¥å°ºå¯¸æœ€ç»ˆèƒ½è¾“å‡ºä¸€ä¸ª13\*13çš„Feature Mapã€‚ ä½¿ç”¨Anchor Boxä¼šè®©ç²¾ç¡®åº¦ç¨å¾®ä¸‹é™ï¼Œä½†ç”¨äº†å®ƒèƒ½è®©YOLOèƒ½é¢„æµ‹å‡ºå¤§äºä¸€åƒä¸ªæ¡†ï¼ŒåŒæ—¶recallè¾¾åˆ°88%ï¼ŒmAPè¾¾åˆ°69.2%ã€‚

> ç¬¬ä¸€ç¯‡è§£è¯»v1æ—¶æåˆ°ï¼Œæ¯ä¸ªæ ¼ç‚¹é¢„æµ‹ä¸¤ä¸ªçŸ©å½¢æ¡†ï¼Œåœ¨è®¡ç®—lossæ—¶ï¼Œåªè®©ä¸ground truthæœ€æ¥è¿‘çš„æ¡†äº§ç”Ÿlossæ•°å€¼ï¼Œè€Œå¦ä¸€ä¸ªæ¡†ä¸åšä¿®æ­£ã€‚è¿™æ ·è§„å®šä¹‹åï¼Œä½œè€…å‘ç°ä¸¤ä¸ªæ¡†åœ¨ç‰©ä½“çš„å¤§å°ã€é•¿å®½æ¯”ã€ç±»åˆ«ä¸Šé€æ¸æœ‰äº†åˆ†å·¥ã€‚åœ¨v2ä¸­ï¼Œç¥ç»ç½‘ç»œä¸å¯¹é¢„æµ‹çŸ©å½¢æ¡†çš„å®½é«˜çš„ç»å¯¹å€¼è¿›è¡Œé¢„æµ‹ï¼Œè€Œæ˜¯é¢„æµ‹ä¸Anchoræ¡†çš„åå·®ï¼ˆoffsetï¼‰ï¼Œæ¯ä¸ªæ ¼ç‚¹æŒ‡å®šnä¸ªAnchoræ¡†ã€‚åœ¨è®­ç»ƒæ—¶ï¼Œæœ€æ¥è¿‘ground truthçš„æ¡†äº§ç”Ÿlossï¼Œå…¶ä½™æ¡†ä¸äº§ç”Ÿlossã€‚åœ¨å¼•å…¥Anchor Boxæ“ä½œåï¼ŒmAPç”±69.5ä¸‹é™è‡³69.2ï¼ŒåŸå› åœ¨äºï¼Œæ¯ä¸ªæ ¼ç‚¹é¢„æµ‹çš„ç‰©ä½“å˜å¤šä¹‹åï¼Œå¬å›ç‡å¤§å¹…ä¸Šå‡ï¼Œå‡†ç¡®ç‡æœ‰æ‰€ä¸‹é™ï¼Œæ€»ä½“mAPç•¥æœ‰ä¸‹é™ã€‚
>
> v2ä¸­ç§»é™¤äº†v1æœ€åçš„ä¸¤å±‚å…¨è¿æ¥å±‚ï¼Œå…¨è¿æ¥å±‚è®¡ç®—é‡å¤§ï¼Œè€—æ—¶ä¹…ã€‚æ–‡ä¸­æ²¡æœ‰è¯¦ç»†æè¿°å…¨è¿æ¥å±‚çš„æ›¿æ¢æ–¹æ¡ˆï¼Œè¿™é‡Œç¬”è€…çŒœæµ‹æ˜¯åˆ©ç”¨1*1çš„å·ç§¯å±‚ä»£æ›¿ï¼ˆæ¬¢è¿æŒ‡æ­£ï¼‰ï¼Œå…·ä½“çš„ç½‘ç»œç»“æ„åŸæ–‡ä¸­æ²¡æœ‰æåŠï¼Œå®˜æ–¹ä»£ç ä¹Ÿè¢«yolo v3æ›¿ä»£äº†ã€‚v2ä¸»è¦æ˜¯å„ç§trickå¼•å…¥åçš„æ•ˆæœéªŒè¯ï¼Œå»ºè®®ä¸å¿…çº ç»“äºv2çš„ç½‘ç»œç»“æ„ã€‚

### **2.4 Dimension clustersï¼ˆèšç±»æå–å…ˆéªŒæ¡†çš„å°ºåº¦ä¿¡æ¯ï¼‰**

> Anchor Boxçš„å®½é«˜ç”±èšç±»äº§ç”Ÿ

ä¹‹å‰Anchor Boxçš„å°ºå¯¸æ˜¯æ‰‹åŠ¨é€‰æ‹©çš„ï¼Œæ‰€ä»¥å°ºå¯¸è¿˜æœ‰ä¼˜åŒ–çš„ä½™åœ°ã€‚ YOLO2å°è¯•ç»Ÿè®¡å‡ºæ›´ç¬¦åˆæ ·æœ¬ä¸­å¯¹è±¡å°ºå¯¸çš„å…ˆéªŒæ¡†ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ç½‘ç»œå¾®è°ƒå…ˆéªŒæ¡†åˆ°å®é™…ä½ç½®çš„éš¾åº¦ã€‚YOLO2çš„åšæ³•æ˜¯å¯¹è®­ç»ƒé›†ä¸­æ ‡æ³¨çš„è¾¹æ¡†è¿›è¡ŒK-meanèšç±»åˆ†æï¼Œä»¥å¯»æ‰¾å°½å¯èƒ½åŒ¹é…æ ·æœ¬çš„è¾¹æ¡†å°ºå¯¸ã€‚

å¦‚æœæˆ‘ä»¬ç”¨æ ‡å‡†çš„æ¬§å¼è·ç¦»çš„k-meansï¼Œå°ºå¯¸å¤§çš„æ¡†æ¯”å°æ¡†äº§ç”Ÿæ›´å¤šçš„é”™è¯¯ã€‚å› ä¸ºæˆ‘ä»¬çš„ç›®çš„æ˜¯æé«˜IOUåˆ†æ•°ï¼Œè¿™ä¾èµ–äºBoxçš„å¤§å°ï¼Œæ‰€ä»¥è·ç¦»åº¦é‡çš„ä½¿ç”¨ï¼š



![img](imgs/v2-188fa2572453119bbe96dd00102b7163_720w.png)



centroidæ˜¯èšç±»æ—¶è¢«é€‰ä½œä¸­å¿ƒçš„è¾¹æ¡†ï¼Œboxå°±æ˜¯å…¶å®ƒè¾¹æ¡†ï¼Œdå°±æ˜¯ä¸¤è€…é—´çš„â€œè·ç¦»â€ã€‚IOUè¶Šå¤§ï¼Œâ€œè·ç¦»â€è¶Šè¿‘ã€‚YOLO2ç»™å‡ºçš„èšç±»åˆ†æç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

é€šè¿‡åˆ†æå®éªŒç»“æœï¼ˆFigure 2ï¼‰ï¼Œå·¦å›¾ï¼šåœ¨modelå¤æ‚æ€§ä¸high recallä¹‹é—´æƒè¡¡ä¹‹åï¼Œé€‰æ‹©èšç±»åˆ†ç±»æ•°K=5ã€‚å³å›¾ï¼šæ˜¯èšç±»çš„ä¸­å¿ƒï¼Œå¤§å¤šæ•°æ˜¯é«˜ç˜¦çš„Boxã€‚

Table1æ˜¯è¯´æ˜ç”¨K-meansé€‰æ‹©Anchor Boxesæ—¶ï¼Œå½“Cluster IOUé€‰æ‹©å€¼ä¸º5æ—¶ï¼ŒAVG IOUçš„å€¼æ˜¯61ï¼Œè¿™ä¸ªå€¼è¦æ¯”ä¸ç”¨èšç±»çš„æ–¹æ³•çš„60.9è¦é«˜ã€‚é€‰æ‹©å€¼ä¸º9çš„æ—¶å€™ï¼ŒAVG IOUæ›´æœ‰æ˜¾è‘—æé«˜ã€‚æ€»ä¹‹å°±æ˜¯è¯´æ˜ç”¨èšç±»çš„æ–¹æ³•æ˜¯æœ‰æ•ˆæœçš„ã€‚

![img](imgs/v2-25a6f493690a0ee96526d560842c01cc_720w.png)

> è¿™é‡Œç®—æ˜¯ä½œè€…çš„ä¸€ä¸ªåˆ›æ–°ç‚¹ã€‚Faster R-CNNä¸­çš„ä¹ä¸ªAnchor Boxçš„å®½é«˜æ˜¯äº‹å…ˆè®¾å®šå¥½çš„æ¯”ä¾‹å¤§å°ï¼Œä¸€å…±è®¾å®šä¸‰ä¸ªé¢ç§¯å¤§å°çš„çŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†æœ‰ä¸‰ä¸ªå®½é«˜æ¯”ï¼š1:1ï¼Œ2:1ï¼Œ1:2ï¼Œæ€»å…±ä¹ä¸ªæ¡†ã€‚è€Œåœ¨v2ä¸­ï¼ŒAnchor Boxçš„å®½é«˜ä¸ç»è¿‡äººä¸ºè·å¾—ï¼Œè€Œæ˜¯å°†è®­ç»ƒæ•°æ®é›†ä¸­çš„çŸ©å½¢æ¡†å…¨éƒ¨æ‹¿å‡ºæ¥ï¼Œç”¨kmeansèšç±»å¾—åˆ°å…ˆéªŒæ¡†çš„å®½å’Œé«˜ã€‚ä¾‹å¦‚ä½¿ç”¨5ä¸ªAnchor Boxï¼Œé‚£ä¹ˆkmeansèšç±»çš„ç±»åˆ«ä¸­å¿ƒä¸ªæ•°è®¾ç½®ä¸º5ã€‚åŠ å…¥äº†èšç±»æ“ä½œä¹‹åï¼Œå¼•å…¥Anchor Boxä¹‹åï¼ŒmAPä¸Šå‡ã€‚
>
> éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œèšç±»å¿…é¡»è¦å®šä¹‰èšç±»ç‚¹ï¼ˆçŸ©å½¢æ¡† ![[å…¬å¼]](https://www.zhihu.com/equation?tex=%28w%2Ch%29)ï¼‰ä¹‹é—´çš„è·ç¦»å‡½æ•°ï¼Œæ–‡ä¸­ä½¿ç”¨å¦‚ä¸‹å‡½æ•°ï¼š
>
> ![img](imgs/v2-418f012af6cc4f94db0486cdca8968aa_720w.png)
>
> ä½¿ç”¨ï¼ˆ1-IOUï¼‰æ•°å€¼ä½œä¸ºä¸¤ä¸ªçŸ©å½¢æ¡†çš„çš„è·ç¦»å‡½æ•°ï¼Œè¿™é‡Œçš„è¿ç”¨ä¹Ÿæ˜¯éå¸¸çš„å·§å¦™ã€‚

### 2.5 Direct location predictionï¼ˆ**çº¦æŸé¢„æµ‹è¾¹æ¡†çš„ä½ç½®**ï¼‰

> ç»å¯¹ä½ç½®é¢„æµ‹

å€Ÿé‰´äºFaster RCNNçš„å…ˆéªŒæ¡†æ–¹æ³•ï¼Œåœ¨è®­ç»ƒçš„æ—©æœŸé˜¶æ®µï¼Œå…¶ä½ç½®é¢„æµ‹å®¹æ˜“ä¸ç¨³å®šã€‚å…¶ä½ç½®é¢„æµ‹å…¬å¼ä¸ºï¼š

 ![[å…¬å¼]](https://www.zhihu.com/equation?tex=%5C%5C+x%3D%28t_x%E2%88%97w_a%29%2Bx_a+%5C%5C+y%3D%28t_y%E2%88%97h_a%29%2By_a+)



å…¶ä¸­ï¼Œ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=x%2Cy) æ˜¯é¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒï¼Œ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=x_a%2Cy_a) æ˜¯å…ˆéªŒæ¡†ï¼ˆanchorï¼‰çš„ä¸­å¿ƒç‚¹åæ ‡ï¼Œ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=w_a%2Ch_a) æ˜¯å…ˆéªŒæ¡†ï¼ˆanchorï¼‰çš„å®½å’Œé«˜ï¼Œ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x%2Ct_y) æ˜¯è¦å­¦ä¹ çš„å‚æ•°ã€‚ æ³¨æ„ï¼ŒYOLOè®ºæ–‡ä¸­å†™çš„æ˜¯ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=x%3D%28t_x%E2%88%97w_a%29-x_a)ï¼Œæ ¹æ®Faster RCNNï¼Œåº”è¯¥æ˜¯"+"ã€‚



ç”±äº ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x%2Ct_y) çš„å–å€¼æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œå› æ­¤é¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒå¯èƒ½å‡ºç°åœ¨ä»»ä½•ä½ç½®ï¼Œè®­ç»ƒæ—©æœŸé˜¶æ®µä¸å®¹æ˜“ç¨³å®šã€‚YOLOè°ƒæ•´äº†é¢„æµ‹å…¬å¼ï¼Œå°†é¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒçº¦æŸåœ¨ç‰¹å®šgirdç½‘æ ¼å†…ã€‚

 ![[å…¬å¼]](https://www.zhihu.com/equation?tex=%5C%5C+b_x%3D%CF%83%28t_x%29%2Bc_x++%5C%5C+b_y%3D%CF%83%28t_y%29%2Bc_y++%5C%5C+b_w%3Dp_we%5E%7Bt_w%7D++%5C%5C+b_h%3Dp_he%5E%7Bt_h%7D++%5C%5C+Pr%28object%29%E2%88%97IOU%28b%2Cobject%29%3D%CF%83%28t_o%29+)

å…¶ä¸­ï¼Œ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=b_x%2Cb_y%2Cb_w%2Cb_h) æ˜¯é¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒå’Œå®½é«˜ã€‚ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=Pr%28object%29%E2%88%97IOU%28b%2Cobject%29) æ˜¯é¢„æµ‹è¾¹æ¡†çš„ç½®ä¿¡åº¦ï¼ŒYOLO1æ˜¯ç›´æ¥é¢„æµ‹ç½®ä¿¡åº¦çš„å€¼ï¼Œè¿™é‡Œå¯¹é¢„æµ‹å‚æ•° ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_o) è¿›è¡ŒÏƒå˜æ¢åä½œä¸ºç½®ä¿¡åº¦çš„å€¼ã€‚ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=c_x%2Cc_y)æ˜¯å½“å‰ç½‘æ ¼å·¦ä¸Šè§’åˆ°å›¾åƒå·¦ä¸Šè§’çš„è·ç¦»ï¼Œè¦å…ˆå°†ç½‘æ ¼å¤§å°å½’ä¸€åŒ–ï¼Œå³ä»¤ä¸€ä¸ªç½‘æ ¼çš„å®½=1ï¼Œé«˜=1ã€‚ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=p_w%2Cp_h) æ˜¯å…ˆéªŒæ¡†çš„å®½å’Œé«˜ã€‚ Ïƒæ˜¯sigmoidå‡½æ•°ã€‚ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x%2Ct_y%2Ct_w%2Ct_h%2Ct_o) æ˜¯è¦å­¦ä¹ çš„å‚æ•°ï¼Œåˆ†åˆ«ç”¨äºé¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒå’Œå®½é«˜ï¼Œä»¥åŠç½®ä¿¡åº¦ã€‚

![img](imgs/v2-6341941a2e569705a3b3d5d740ff0e0c_720w.png)

å› ä¸ºä½¿ç”¨äº†é™åˆ¶è®©æ•°å€¼å˜å¾—å‚æ•°åŒ–ï¼Œä¹Ÿè®©ç½‘ç»œæ›´å®¹æ˜“å­¦ä¹ ã€æ›´ç¨³å®šã€‚

> Yoloä¸­çš„ä½ç½®é¢„æµ‹æ–¹æ³•å¾ˆæ¸…æ™°ï¼Œå°±æ˜¯ç›¸å¯¹äºå·¦ä¸Šè§’çš„æ ¼ç‚¹åæ ‡é¢„æµ‹åç§»é‡ã€‚è¿™é‡Œçš„Directå…·ä½“å«ä¹‰ï¼Œåº”è¯¥æ˜¯å’Œå…¶ä»–ç®—æ³•æ¡†æ¶å¯¹æ¯”åå¾—åˆ°çš„ã€‚æ¯”å¦‚å…¶ä»–æµè¡Œçš„ä½ç½®é¢„æµ‹å…¬å¼å¦‚ä¸‹ï¼ˆåŸæ–‡ä¸­æ˜¯å‡å·ï¼Œåº”è¯¥æ˜¯åŠ å·ï¼Œæ— ä¼¤å¤§é›…ï¼‰ï¼š
>
> ![img](imgs/v2-9d577424c78f0edf11572ca31256cbb8_720w.png)
>
> ç¥ç»ç½‘ç»œé¢„æµ‹ ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x+%2Ct_y) ï¼Œè€Œ![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x+%2Ct_y)åˆéœ€è¦ä¸å…ˆéªŒæ¡†çš„å®½é«˜ç›¸ä¹˜æ‰èƒ½å¾—åˆ°ç›¸è¾ƒäº ![[å…¬å¼]](https://www.zhihu.com/equation?tex=x_a%2C+y_a) çš„ä½ç½®åç§»å€¼ï¼Œåœ¨v2ä¸­ï¼Œä½ç½®é¢„æµ‹å…¬å¼å¦‚ä¸‹ï¼š
>
> ![img](imgs/v2-60e8722aaf9eedbe077d2d5535a5b288_720w.png)
>
> Yoloçš„å¤©ç„¶ä¼˜åŠ¿ï¼Œå°±æ˜¯æ ¼ç‚¹çš„åæ ‡å¯ä»¥ä½œä¸ºå‚ç…§ç‚¹ã€‚æ­¤æ—¶![[å…¬å¼]](https://www.zhihu.com/equation?tex=t_x+%2Ct_y)é€šè¿‡ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œç›´æ¥äº§ç”Ÿåç§»ä½ç½®æ•°å€¼ï¼Œä¸çŸ©å½¢æ¡†çš„å®½é«˜ç‹¬ç«‹å¼€ï¼Œå˜å¾—æ›´åŠ ç›´æ¥ã€‚

### **2.6 Fine-Grained Featuresï¼ˆpassthroughå±‚æ£€æµ‹ç»†ç²’åº¦ç‰¹å¾ï¼‰**

> ç»†ç²’åº¦ç‰¹å¾

passthroughå±‚æ£€æµ‹ç»†ç²’åº¦ç‰¹å¾ä½¿mAPæå‡1ã€‚

å¯¹è±¡æ£€æµ‹é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜æ˜¯å›¾åƒä¸­å¯¹è±¡ä¼šæœ‰å¤§æœ‰å°ï¼Œè¾“å…¥å›¾åƒç»è¿‡å¤šå±‚ç½‘ç»œæå–ç‰¹å¾ï¼Œæœ€åè¾“å‡ºçš„ç‰¹å¾å›¾ä¸­ï¼ˆæ¯”å¦‚YOLO2ä¸­è¾“å…¥416\*416ç»è¿‡å·ç§¯ç½‘ç»œä¸‹é‡‡æ ·æœ€åè¾“å‡ºæ˜¯13\*13ï¼‰ï¼Œè¾ƒå°çš„å¯¹è±¡å¯èƒ½ç‰¹å¾å·²ç»ä¸æ˜æ˜¾ç”šè‡³è¢«å¿½ç•¥æ‰äº†ã€‚ä¸ºäº†æ›´å¥½çš„æ£€æµ‹å‡ºä¸€äº›æ¯”è¾ƒå°çš„å¯¹è±¡ï¼Œæœ€åè¾“å‡ºçš„ç‰¹å¾å›¾éœ€è¦ä¿ç•™ä¸€äº›æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚

YOLO2å¼•å…¥ä¸€ç§ç§°ä¸ºpassthroughå±‚çš„æ–¹æ³•åœ¨ç‰¹å¾å›¾ä¸­ä¿ç•™ä¸€äº›ç»†èŠ‚ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨æœ€åä¸€ä¸ªpoolingä¹‹å‰ï¼Œç‰¹å¾å›¾çš„å¤§å°æ˜¯26\*26\*512ï¼Œå°†å…¶1æ‹†4ï¼Œç›´æ¥ä¼ é€’ï¼ˆpassthroughï¼‰åˆ°poolingåï¼ˆå¹¶ä¸”åˆç»è¿‡ä¸€ç»„å·ç§¯ï¼‰çš„ç‰¹å¾å›¾ï¼Œä¸¤è€…å åŠ åˆ°ä¸€èµ·ä½œä¸ºè¾“å‡ºçš„ç‰¹å¾å›¾ã€‚

![img](imgs/v2-94296e423b799e75e7cb92468b5b4b48_720w.png)



å…·ä½“æ€æ ·1æ‹†4ï¼Œä¸‹é¢å€Ÿç”¨ä¸€å‰¯å›¾çœ‹çš„å¾ˆæ¸…æ¥šã€‚å›¾ä¸­ç¤ºä¾‹çš„æ˜¯1ä¸ª4\*4æ‹†æˆ4ä¸ª2\*2ã€‚å› ä¸ºæ·±åº¦ä¸å˜ï¼Œæ‰€ä»¥æ²¡æœ‰ç”»å‡ºæ¥ã€‚

![img](imgs/v2-f32449af20ecc374582717ab1f97783f_720w.jpg)



å¦å¤–ï¼Œæ ¹æ®YOLO2çš„ä»£ç ï¼Œç‰¹å¾å›¾å…ˆç”¨1\*1å·ç§¯ä» 26\*26\*512 é™ç»´åˆ° 26\*26\*64ï¼Œå†åš1æ‹†4å¹¶passthroughã€‚ä¸‹é¢å›¾6æœ‰æ›´è¯¦ç»†çš„ç½‘ç»œè¾“å…¥è¾“å‡ºç»“æ„ã€‚

> åœ¨26*26çš„ç‰¹å¾å›¾ï¼Œç»è¿‡å·ç§¯å±‚ç­‰ï¼Œå˜ä¸º13*13çš„ç‰¹å¾å›¾åï¼Œä½œè€…è®¤ä¸ºæŸå¤±äº†å¾ˆå¤šç»†ç²’åº¦çš„ç‰¹å¾ï¼Œå¯¼è‡´å°å°ºå¯¸ç‰©ä½“çš„è¯†åˆ«æ•ˆæœä¸ä½³ï¼Œæ‰€ä»¥åœ¨æ­¤åŠ å…¥äº†passthroughå±‚ã€‚
>
> ![img](imgs/v2-293f609a711615905b0bf7faa83583f8_720w.png)
>
> å›¾äºŒ passthroughå±‚
>
> å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œpassthroughå±‚å°±æ˜¯å°†26*26*1çš„ç‰¹å¾å›¾ï¼Œå˜æˆ13*13*4çš„ç‰¹å¾å›¾ï¼Œåœ¨è¿™ä¸€æ¬¡æ“ä½œä¸­ä¸æŸå¤±ç»†ç²’åº¦ç‰¹å¾ã€‚æœ‰äººè¯´passthroughå±‚åˆ†æˆå››ä»½çš„å…·ä½“ç»†èŠ‚ï¼Œå¹¶ä¸æ˜¯ä¸¤åˆ€åˆ‡æˆ4å—ï¼Œè€Œæ˜¯åœ¨æ¯ä¸ª2*2çš„å°åŒºåŸŸä¸Šéƒ½é€‰æ‹©å·¦ä¸Šè§’å—ã€‚å…¶å®è¿™é‡Œæ€ä¹ˆåˆ‡éƒ½ä¸€æ ·ï¼Œåœ¨ä¹‹å1*1å·ç§¯å±‚ä¸­ï¼Œä¸è¿‡æ˜¯åŠ æ³•äº¤æ¢å¾‹çš„äº‹ã€‚



### 2.7 **Multi-ScaleTrainingï¼ˆå¤šå°ºåº¦å›¾åƒè®­ç»ƒï¼‰**

ä½œè€…å¸Œæœ›YOLO v2èƒ½å¥å£®çš„è¿è¡Œäºä¸åŒå°ºå¯¸çš„å›¾ç‰‡ä¹‹ä¸Šï¼Œæ‰€ä»¥æŠŠè¿™ä¸€æƒ³æ³•ç”¨äºè®­ç»ƒmodelä¸­ã€‚

åŒºåˆ«äºä¹‹å‰çš„è¡¥å…¨å›¾ç‰‡çš„å°ºå¯¸çš„æ–¹æ³•ï¼ŒYOLO v2æ¯è¿­ä»£å‡ æ¬¡éƒ½ä¼šæ”¹å˜ç½‘ç»œå‚æ•°ã€‚æ¯10ä¸ªBatchï¼Œç½‘ç»œä¼šéšæœºåœ°é€‰æ‹©ä¸€ä¸ªæ–°çš„å›¾ç‰‡å°ºå¯¸ï¼Œç”±äºä½¿ç”¨äº†ä¸‹é‡‡æ ·å‚æ•°æ˜¯32ï¼Œæ‰€ä»¥ä¸åŒçš„å°ºå¯¸å¤§å°ä¹Ÿé€‰æ‹©ä¸º32çš„å€æ•°{320ï¼Œ352â€¦..608}ï¼Œæœ€å°320\*320ï¼Œæœ€å¤§608\*608ï¼Œç½‘ç»œä¼šè‡ªåŠ¨æ”¹å˜å°ºå¯¸ï¼Œå¹¶ç»§ç»­è®­ç»ƒçš„è¿‡ç¨‹ã€‚

è¿™ä¸€æ”¿ç­–è®©ç½‘ç»œåœ¨ä¸åŒçš„è¾“å…¥å°ºå¯¸ä¸Šéƒ½èƒ½è¾¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„é¢„æµ‹æ•ˆæœï¼ŒåŒä¸€ç½‘ç»œèƒ½åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸Šè¿›è¡Œæ£€æµ‹ã€‚å½“è¾“å…¥å›¾ç‰‡å°ºå¯¸æ¯”è¾ƒå°çš„æ—¶å€™è·‘çš„æ¯”è¾ƒå¿«ï¼Œè¾“å…¥å›¾ç‰‡å°ºå¯¸æ¯”è¾ƒå¤§çš„æ—¶å€™ç²¾åº¦é«˜ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨YOLO v2çš„é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¿›è¡Œæƒè¡¡ã€‚

Figure4ï¼ŒTable 3ï¼šåœ¨voc2007ä¸Šçš„é€Ÿåº¦ä¸ç²¾åº¦

![img](imgs/v2-d007e1d38b6e6653f519abdfc9212647_720w.jpg)

> å¾ˆå…³é”®çš„ä¸€ç‚¹æ˜¯ï¼ŒYolo v2ä¸­åªæœ‰å·ç§¯å±‚ä¸æ± åŒ–å±‚ï¼Œæ‰€ä»¥å¯¹äºç½‘ç»œçš„è¾“å…¥å¤§å°ï¼Œå¹¶æ²¡æœ‰é™åˆ¶ï¼Œæ•´ä¸ªç½‘ç»œçš„é™é‡‡æ ·å€æ•°ä¸º32ï¼Œåªè¦è¾“å…¥çš„ç‰¹å¾å›¾å°ºå¯¸ä¸º32çš„å€æ•°å³å¯ï¼Œå¦‚æœç½‘ç»œä¸­æœ‰å…¨è¿æ¥å±‚ï¼Œå°±ä¸æ˜¯è¿™æ ·äº†ã€‚æ‰€ä»¥Yolo v2å¯ä»¥ä½¿ç”¨ä¸åŒå°ºå¯¸çš„è¾“å…¥å›¾ç‰‡è®­ç»ƒã€‚
>
> ä½œè€…ä½¿ç”¨çš„è®­ç»ƒæ–¹æ³•æ˜¯ï¼Œåœ¨æ¯10ä¸ªbatchä¹‹åï¼Œå°±å°†å›¾ç‰‡resizeæˆ{320, 352, ..., 608}ä¸­çš„ä¸€ç§ã€‚ä¸åŒçš„è¾“å…¥ï¼Œæœ€åäº§ç”Ÿçš„æ ¼ç‚¹æ•°ä¸åŒï¼Œæ¯”å¦‚è¾“å…¥å›¾ç‰‡æ˜¯320*320ï¼Œé‚£ä¹ˆè¾“å‡ºæ ¼ç‚¹æ˜¯10*10ï¼Œå¦‚æœæ¯ä¸ªæ ¼ç‚¹çš„å…ˆéªŒæ¡†ä¸ªæ•°è®¾ç½®ä¸º5ï¼Œé‚£ä¹ˆæ€»å…±è¾“å‡º500ä¸ªé¢„æµ‹ç»“æœï¼›å¦‚æœè¾“å…¥å›¾ç‰‡å¤§å°æ˜¯608*608ï¼Œè¾“å‡ºæ ¼ç‚¹å°±æ˜¯19*19ï¼Œå…±1805ä¸ªé¢„æµ‹ç»“æœã€‚
>
> åœ¨å¼•å…¥äº†å¤šå°ºå¯¸è®­ç»ƒæ–¹æ³•åï¼Œè¿«ä½¿å·ç§¯æ ¸å­¦ä¹ ä¸åŒæ¯”ä¾‹å¤§å°å°ºå¯¸çš„ç‰¹å¾ã€‚å½“è¾“å…¥è®¾ç½®ä¸º544*544ç”šè‡³æ›´å¤§ï¼ŒYolo v2çš„mAPå·²ç»è¶…è¿‡äº†å…¶ä»–çš„ç‰©ä½“æ£€æµ‹ç®—æ³•ã€‚

### 2.8 **hi-res detectorï¼ˆé«˜åˆ†è¾¨ç‡å›¾åƒçš„å¯¹è±¡æ£€æµ‹ï¼‰**

å›¾1è¡¨æ ¼ä¸­æœ€åä¸€è¡Œæœ‰ä¸ªhi-res detectorï¼Œä½¿mAPæé«˜äº†1.8ã€‚å› ä¸ºYOLO2è°ƒæ•´ç½‘ç»œç»“æ„åèƒ½å¤Ÿæ”¯æŒå¤šç§å°ºå¯¸çš„è¾“å…¥å›¾åƒã€‚é€šå¸¸æ˜¯ä½¿ç”¨416\*416çš„è¾“å…¥å›¾åƒï¼Œå¦‚æœç”¨è¾ƒé«˜åˆ†è¾¨ç‡çš„è¾“å…¥å›¾åƒï¼Œæ¯”å¦‚544\*544ï¼Œåˆ™mAPå¯ä»¥è¾¾åˆ°78.6ï¼Œæœ‰1.8çš„æå‡ã€‚



### 2.9 å…¶ä»–

**----------------Faster--------------**   

Darknet-19 

![img](imgs/v2-ecf11e8afcf032aec8a279fe19eb5e43_720w.png)

å›¾ä¸‰ Darknet-19ç½‘ç»œç»“æ„

v2ä¸­ä½œè€…æå‡ºäº†æ–°çš„åˆ†ç±»ç½‘ç»œæ¶æ„â€”â€”Darknet-19ï¼Œè¯¥æ¶æ„çš„ç½‘ç»œå‚æ•°è¾ƒVGG-16æ›´å°‘ï¼Œåœ¨ImageNetä¸Šï¼Œä»ç„¶å¯ä»¥è¾¾åˆ°top-1 72.9%ä»¥åŠtop-5 91.2%çš„ç²¾åº¦ã€‚



- Yolo v2ç²¾åº¦ä¸æ€§èƒ½

å…¨éƒ¨çš„trickæ•ˆæœå¦‚ä¸‹ï¼Œé™¤äº†ç›´æ¥å¼•å…¥äººä¸ºæŒ‡å®šå®½é«˜çš„Anchor Boxesï¼Œå…¶ä»–æŠ€å·§éƒ½å¸¦æ¥äº†ä¸€å®šçš„å¢ç›Šã€‚

![img](imgs/v2-7f5a5126193f3b36181e1e4626546ec8_720w.png)

å›¾å›› Yolo v2æå‡æ•ˆæœ

é™„ä¸€ä¸‹Yolo v2ä¸å…¶ä»–ç®—æ³•çš„å¯¹æ¯”å›¾ï¼š

![img](imgs/v2-d921a1879166aa0dfcfd3299364dcdf3_720w.png)

å›¾äº” Yolo v2ç²¾åº¦å¯¹æ¯”(on COCO test-dev2015)

![img](imgs/v2-fbd4506a83e44ba74493b4bfcf79d1b7_720w.png)

å›¾å…­ Yolo v2ç²¾åº¦ä¸é€Ÿç‡å¯¹æ¯”ï¼ˆon PASCAL VOCï¼‰

Yolo v2çš„ç²¾åº¦å¯ä»¥æ¯”è‚©ä¸šç•Œå‰æ²¿ç®—æ³•ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒç€å¤§å¹…åº¦é€Ÿç‡é¢†å…ˆã€‚



## 3. Yolo9000: Stronger

#### Joint classification and detection

å¦‚æœè¯´æ•´ä¸ªYolo v2çš„Betteréƒ¨åˆ†ï¼Œéƒ½æ²¡æœ‰ä»€ä¹ˆå¤§çš„åˆ›æ–°ç‚¹ï¼Œè¿™é‡Œçš„åˆ†ç±»ä¸æ£€æµ‹è”åˆè®­ç»ƒï¼Œå°±æ˜¯Yolo v2çš„ä¸€å¤§äº®ç‚¹ï¼Œå› ä¸ºè¿™ä¸€ä¸ªæŠ€å·§ï¼ŒYolo v2æ‰æˆä¸ºäº†Yolo9000ã€‚

å¦‚ä¹‹å‰æ‰€è¯´ï¼Œç‰©ä½“åˆ†ç±»ï¼Œæ˜¯å¯¹æ•´å¼ å›¾ç‰‡æ‰“æ ‡ç­¾ï¼Œæ¯”å¦‚è¿™å¼ å›¾ç‰‡ä¸­å«æœ‰äººï¼Œå¦ä¸€å¼ å›¾ç‰‡ä¸­çš„ç‰©ä½“ä¸ºç‹—ï¼›è€Œç‰©ä½“æ£€æµ‹ä¸ä»…å¯¹ç‰©ä½“çš„ç±»åˆ«è¿›è¡Œé¢„æµ‹ï¼ŒåŒæ—¶éœ€è¦æ¡†å‡ºç‰©ä½“åœ¨å›¾ç‰‡ä¸­çš„ä½ç½®ã€‚ç‰©ä½“åˆ†ç±»çš„æ•°æ®é›†ï¼Œæœ€è‘—åçš„ImageNetï¼Œç‰©ä½“ç±»åˆ«æœ‰ä¸Šä¸‡ä¸ªï¼Œè€Œç‰©ä½“æ£€æµ‹æ•°æ®é›†ï¼Œä¾‹å¦‚cocoï¼Œåªæœ‰80ä¸ªç±»åˆ«ï¼Œå› ä¸ºç‰©ä½“æ£€æµ‹ã€åˆ†å‰²çš„æ‰“æ ‡ç­¾æˆæœ¬æ¯”ç‰©ä½“åˆ†ç±»æ‰“æ ‡ç­¾æˆæœ¬è¦é«˜å¾ˆå¤šã€‚æ‰€ä»¥åœ¨è¿™é‡Œï¼Œä½œè€…æå‡ºäº†åˆ†ç±»ã€æ£€æµ‹è®­ç»ƒé›†è”åˆè®­ç»ƒçš„æ–¹æ¡ˆã€‚

è”åˆè®­ç»ƒæ–¹æ³•æ€è·¯ç®€å•æ¸…æ™°ï¼ŒYolo v2ä¸­ç‰©ä½“çŸ©å½¢æ¡†ç”Ÿæˆï¼Œä¸ä¾èµ–äºç‰©ç†ç±»åˆ«é¢„æµ‹ï¼ŒäºŒè€…åŒæ—¶ç‹¬ç«‹è¿›è¡Œã€‚å½“è¾“å…¥æ˜¯æ£€æµ‹æ•°æ®é›†æ—¶ï¼Œæ ‡æ³¨ä¿¡æ¯æœ‰ç±»åˆ«ã€æœ‰ä½ç½®ï¼Œé‚£ä¹ˆå¯¹æ•´ä¸ªlosså‡½æ•°è®¡ç®—lossï¼Œè¿›è¡Œåå‘ä¼ æ’­ï¼›å½“è¾“å…¥å›¾ç‰‡åªåŒ…å«åˆ†ç±»ä¿¡æ¯æ—¶ï¼Œlosså‡½æ•°åªè®¡ç®—åˆ†ç±»lossï¼Œå…¶ä½™éƒ¨åˆ†lossä¸ºé›¶ã€‚å½“ç„¶ï¼Œä¸€èˆ¬çš„è®­ç»ƒç­–ç•¥ä¸ºï¼Œå…ˆåœ¨æ£€æµ‹æ•°æ®é›†ä¸Šè®­ç»ƒä¸€å®šçš„epochï¼Œå¾…é¢„æµ‹æ¡†çš„lossåŸºæœ¬ç¨³å®šåï¼Œå†è”åˆåˆ†ç±»æ•°æ®é›†ã€æ£€æµ‹æ•°æ®é›†è¿›è¡Œäº¤æ›¿è®­ç»ƒï¼ŒåŒæ—¶ä¸ºäº†åˆ†ç±»ã€æ£€æµ‹æ•°æ®é‡å¹³è¡¡ï¼Œä½œè€…å¯¹cocoæ•°æ®é›†è¿›è¡Œäº†ä¸Šé‡‡æ ·ï¼Œä½¿å¾—cocoæ•°æ®æ€»æ•°å’ŒImageNetå¤§è‡´ç›¸åŒã€‚

è”åˆåˆ†ç±»ä¸æ£€æµ‹æ•°æ®é›†ï¼Œè¿™é‡Œä¸åŒäºå°†ç½‘ç»œçš„backboneåœ¨ImageNetä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œé¢„è®­ç»ƒåªèƒ½æé«˜å·ç§¯æ ¸çš„é²æ£’æ€§ï¼Œè€Œåˆ†ç±»æ£€æµ‹æ•°æ®é›†è”åˆï¼Œå¯ä»¥æ‰©å……è¯†åˆ«ç‰©ä½“ç§ç±»ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹ç‰©ä½“æ•°æ®é›†ä¸­ï¼Œæœ‰ç±»åˆ«äººï¼Œå½“ç½‘ç»œæœ‰äº†ä¸€å®šçš„æ‰¾å‡ºäººçš„ä½ç½®çš„èƒ½åŠ›åï¼Œå¯ä»¥é€šè¿‡åˆ†ç±»æ•°æ®é›†ï¼Œæ·»åŠ ç»†åˆ†ç±»åˆ«ï¼šç”·äººã€å¥³äººã€å°å­©ã€æˆäººã€è¿åŠ¨å‘˜ç­‰ç­‰ã€‚è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç±»åˆ«ä¹‹é—´å¹¶ä¸ä¸€å®šæ˜¯äº’æ–¥å…³ç³»ï¼Œå¯èƒ½æ˜¯åŒ…å«ï¼ˆä¾‹å¦‚äººä¸ç”·äººï¼‰ã€ç›¸äº¤ï¼ˆè¿åŠ¨å‘˜ä¸ç”·äººï¼‰ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œä¸­ï¼Œè¯¥æ€ä¹ˆå¯¹ç±»åˆ«è¿›è¡Œé¢„æµ‹å’Œè®­ç»ƒå‘¢ï¼Ÿ

#### Dataset combination with WordTree

åœ¨æ–‡ä¸­ï¼Œä½œè€…ä½¿ç”¨WordTreeï¼Œè§£å†³äº†ImageNetä¸cocoä¹‹é—´çš„ç±»åˆ«é—®é¢˜ã€‚

![img](imgs/v2-d97c86a0d92ab45913405a6e55c2dd4f_720w.png)

å›¾ä¸ƒ WordTree for COCO and ImageNet

æ ‘ç»“æ„è¡¨ç¤ºç‰©ä½“ä¹‹é—´çš„ä»å±å…³ç³»éå¸¸åˆé€‚ï¼Œç¬¬ä¸€ä¸ªå¤§ç±»ï¼Œç‰©ä½“ï¼Œç‰©ä½“ä¹‹ä¸‹æœ‰åŠ¨ç‰©ã€äººå·¥åˆ¶å“ã€è‡ªç„¶ç‰©ä½“ç­‰ï¼ŒåŠ¨ç‰©ä¸­åˆæœ‰æ›´å…·ä½“çš„åˆ†ç±»ã€‚æ­¤æ—¶ï¼Œåœ¨ç±»åˆ«ä¸­ï¼Œä¸å¯¹æ‰€æœ‰çš„ç±»åˆ«è¿›è¡Œsoftmaxæ“ä½œï¼Œè€Œå¯¹åŒä¸€å±‚çº§çš„ç±»åˆ«è¿›è¡Œsoftmaxï¼š

![img](imgs/v2-9df6a7af550bdff44315499538f64d12_720w.png)

å›¾å…« ç±»åˆ«softmax

å¦‚å›¾ä¸­æ‰€ç¤ºï¼ŒåŒä¸€é¢œè‰²çš„ä½ç½®ï¼Œè¿›è¡Œsoftmaxæ“ä½œï¼Œä½¿å¾—åŒä¸€é¢œè‰²ä¸­åªæœ‰ä¸€ä¸ªç±»åˆ«é¢„æµ‹åˆ†å€¼æœ€å¤§ã€‚åœ¨é¢„æµ‹æ—¶ï¼Œä»æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æ£€ç´¢ï¼Œæ¯æ¬¡é€‰å–é¢„æµ‹åˆ†å€¼æœ€é«˜çš„å­èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰€æœ‰é€‰æ‹©çš„èŠ‚ç‚¹é¢„æµ‹åˆ†å€¼è¿ä¹˜åå°äºæŸä¸€é˜ˆå€¼æ—¶åœæ­¢ã€‚åœ¨è®­ç»ƒæ—¶ï¼Œå¦‚æœæ ‡ç­¾ä¸ºäººï¼Œé‚£ä¹ˆåªå¯¹äººè¿™ä¸ªèŠ‚ç‚¹ä»¥åŠå…¶æ‰€æœ‰çš„çˆ¶èŠ‚ç‚¹è¿›è¡Œlossè®¡ç®—ï¼Œè€Œå…¶å­èŠ‚ç‚¹ï¼Œç”·äººã€å¥³äººã€å°å­©ç­‰ï¼Œä¸è¿›è¡Œlossè®¡ç®—ã€‚

æœ€åçš„ç»“æœæ˜¯ï¼ŒYolo v2å¯ä»¥è¯†åˆ«è¶…è¿‡9000ä¸ªç‰©ä½“ï¼Œä½œè€…ç¾å…¶åæ›°Yolo9000ã€‚å½“ç„¶åŸæ–‡ä¸­ä¹Ÿæåˆ°ï¼Œåªæœ‰å½“çˆ¶èŠ‚ç‚¹åœ¨æ£€æµ‹é›†ä¸­å‡ºç°è¿‡ï¼Œå­èŠ‚ç‚¹çš„é¢„æµ‹æ‰ä¼šæœ‰æ•ˆã€‚å¦‚æœå­èŠ‚ç‚¹æ˜¯è£¤å­ã€Tæ¤ã€è£™å­ç­‰ï¼Œè€Œçˆ¶èŠ‚ç‚¹è¡£æœåœ¨æ£€æµ‹é›†ä¸­æ²¡æœ‰å‡ºç°è¿‡ï¼Œé‚£ä¹ˆæ•´æ¡é¢„æµ‹ç±»åˆ«æ”¯è·¯å‡ ä¹éƒ½æ˜¯æ£€æµ‹å¤±æ•ˆçš„çŠ¶æ€ã€‚è¿™ä¹Ÿåˆç†ï¼Œç»™ç¥ç»ç½‘ç»œçœ‹çš„éƒ½æ˜¯ç‹—ï¼Œè®©å®ƒå»é¢„æµ‹çŒ«ï¼Œç›®å‰ç¥ç»ç½‘ç»œè¿˜æ²¡æœ‰è¿™ä¹ˆæ™ºèƒ½ã€‚



#### Hierarchical classificationï¼ˆåˆ†å±‚åˆ†ç±»ï¼‰

ä½œè€…æå‡ºäº†ä¸€ç§åœ¨åˆ†ç±»æ•°æ®é›†å’Œæ£€æµ‹æ•°æ®é›†ä¸Šè”åˆè®­ç»ƒçš„æœºåˆ¶ã€‚ä½¿ç”¨æ£€æµ‹æ•°æ®é›†çš„å›¾ç‰‡å»å­¦ä¹ æ£€æµ‹ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚bounding box åæ ‡é¢„æµ‹ï¼Œæ˜¯å¦åŒ…å«ç‰©ä½“ä»¥åŠå±äºå„ä¸ªç‰©ä½“çš„æ¦‚ç‡ã€‚ä½¿ç”¨ä»…æœ‰ç±»åˆ«æ ‡ç­¾çš„åˆ†ç±»æ•°æ®é›†å›¾ç‰‡å»æ‰©å±•å¯ä»¥æ£€æµ‹çš„ç§ç±»ã€‚

ä½œè€…é€šè¿‡ImageNetè®­ç»ƒåˆ†ç±»ã€COCOå’ŒVOCæ•°æ®é›†æ¥è®­ç»ƒæ£€æµ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ä»·å€¼çš„æ€è·¯ï¼Œå¯ä»¥è®©æˆ‘ä»¬è¾¾åˆ°æ¯”è¾ƒä¼˜çš„æ•ˆæœã€‚ é€šè¿‡å°†ä¸¤ä¸ªæ•°æ®é›†æ··åˆè®­ç»ƒï¼Œ**å¦‚æœé‡åˆ°æ¥è‡ªåˆ†ç±»é›†çš„å›¾ç‰‡åˆ™åªè®¡ç®—åˆ†ç±»çš„Lossï¼Œé‡åˆ°æ¥è‡ªæ£€æµ‹é›†çš„å›¾ç‰‡åˆ™è®¡ç®—å®Œæ•´çš„Lossã€‚**

ä½†æ˜¯ImageNetå¯¹åº”åˆ†ç±»æœ‰9000ç§ï¼Œè€ŒCOCOåˆ™åªæä¾›80ç§ç›®æ ‡æ£€æµ‹ï¼Œä½œè€…ä½¿ç”¨multi-labelæ¨¡å‹ï¼Œå³å‡å®šä¸€å¼ å›¾ç‰‡å¯ä»¥æœ‰å¤šä¸ªlabelï¼Œå¹¶ä¸”ä¸è¦æ±‚labelé—´ç‹¬ç«‹ã€‚é€šè¿‡ä½œè€…Paperé‡Œçš„å›¾æ¥è¯´æ˜ï¼Œç”±äºImageNetçš„ç±»åˆ«æ˜¯ä»WordNeté€‰å–çš„ï¼Œä½œè€…é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥é‡å»ºäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼ˆç§°ä¸ºåˆ†å±‚æ ‘ï¼‰ï¼š

1. éå†Imagenetçš„labelï¼Œç„¶ååœ¨WordNetä¸­å¯»æ‰¾è¯¥labelåˆ°æ ¹èŠ‚ç‚¹(æŒ‡å‘ä¸€ä¸ªç‰©ç†å¯¹è±¡)çš„è·¯å¾„ï¼›
2. å¦‚æœè·¯å¾„ç›´æœ‰ä¸€æ¡ï¼Œé‚£ä¹ˆå°±å°†è¯¥è·¯å¾„ç›´æ¥åŠ å…¥åˆ°åˆ†å±‚æ ‘ç»“æ„ä¸­ï¼›
3. å¦åˆ™ï¼Œä»å‰©ä½™çš„è·¯å¾„ä¸­é€‰æ‹©ä¸€æ¡æœ€çŸ­è·¯å¾„ï¼ŒåŠ å…¥åˆ°åˆ†å±‚æ ‘ã€‚

è¿™ä¸ªåˆ†å±‚æ ‘æˆ‘ä»¬ç§°ä¹‹ä¸º WordTreeï¼Œä½œç”¨å°±åœ¨äºå°†ä¸¤ç§æ•°æ®é›†æŒ‰ç…§å±‚çº§è¿›è¡Œç»“åˆã€‚

![img](imgs/v2-c98e6eaaf44f0d03be1b5cf32a960fd1_720w.png)

åˆ†ç±»æ—¶çš„æ¦‚ç‡è®¡ç®—å€Ÿç”¨äº†å†³ç­–æ ‘æ€æƒ³ï¼Œ**æŸä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡å€¼ç­‰äºè¯¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰æ¡ä»¶æ¦‚ç‡ä¹‹ç§¯**ã€‚æœ€ç»ˆç»“æœæ˜¯ä¸€é¢— WordTree ï¼ˆè§†è§‰åè¯ç»„æˆçš„å±‚æ¬¡ç»“æ„æ¨¡å‹ï¼‰ã€‚ç”¨WordTreeæ‰§è¡Œåˆ†ç±»æ—¶ï¼Œé¢„æµ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡ã€‚å¦‚æœæƒ³æ±‚å¾—ç‰¹å®šèŠ‚ç‚¹çš„ç»å¯¹æ¦‚ç‡ï¼Œåªéœ€è¦æ²¿ç€è·¯å¾„åšè¿ç»­ä¹˜ç§¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³çŸ¥é“ä¸€å¼ å›¾ç‰‡æ˜¯ä¸æ˜¯â€œNorfolk terrier â€éœ€è¦è®¡ç®—ï¼š

![img](imgs/v2-51f77f7651675389a7433324115c200d_720w.png)

å¦å¤–ï¼Œä¸ºäº†éªŒè¯è¿™ç§æ–¹æ³•ä½œè€…åœ¨WordTreeï¼ˆç”¨1000ç±»åˆ«çš„ImageNetåˆ›å»ºï¼‰ä¸Šè®­ç»ƒäº†Darknet-19æ¨¡å‹ã€‚ä¸ºäº†åˆ›å»ºWordTree1kï¼Œä½œè€…æ·»åŠ äº†å¾ˆå¤šä¸­é—´èŠ‚ç‚¹ï¼ŒæŠŠæ ‡ç­¾ç”±1000æ‰©å±•åˆ°1369ã€‚è®­ç»ƒè¿‡ç¨‹ä¸­ground truthæ ‡ç­¾è¦é¡ºç€å‘æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€å¼ å›¾ç‰‡è¢«æ ‡è®°ä¸ºâ€œNorfolk terrierâ€ï¼Œå®ƒä¹Ÿè¢«æ ‡è®°ä¸ºâ€œdogâ€ å’Œâ€œmammalâ€ç­‰ã€‚ä¸ºäº†è®¡ç®—æ¡ä»¶æ¦‚ç‡ï¼Œæ¨¡å‹é¢„æµ‹äº†ä¸€ä¸ªåŒ…å«1369ä¸ªå…ƒç´ çš„å‘é‡ï¼Œè€Œä¸”åŸºäºæ‰€æœ‰â€œåŒä¹‰è¯é›†â€è®¡ç®—softmaxï¼Œå…¶ä¸­â€œåŒä¹‰è¯é›†â€æ˜¯åŒä¸€æ¦‚å¿µçš„ä¸‹ä½è¯ã€‚

softmaxæ“ä½œä¹ŸåŒæ—¶åº”è¯¥é‡‡ç”¨åˆ†ç»„æ“ä½œï¼Œä¸‹å›¾ä¸ŠåŠéƒ¨åˆ†ä¸ºImageNetå¯¹åº”çš„åŸç”ŸSoftmaxï¼Œä¸‹åŠéƒ¨åˆ†å¯¹åº”åŸºäºWordTreeçš„Softmaxï¼š

![img](imgs/v2-8914d9344611dd63113cdbc6c1b17152_720w.png)

é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆæ„é€ WordTreeï¼Œå¾—åˆ°å¯¹åº”9418ä¸ªåˆ†ç±»ï¼Œé€šè¿‡é‡é‡‡æ ·ä¿è¯Imagenetå’ŒCOCOçš„æ ·æœ¬æ•°æ®æ¯”ä¾‹ä¸º4:1ã€‚

## 4.  Yolov2çš„ç½‘ç»œç»“æ„

ç›¸æ¯”è¾ƒäºYOLO v1ï¼Œä½œè€…åœ¨ä¹‹å‰æ¨¡å‹ä¸Šï¼Œå…ˆä¿®ä¿®è¡¥è¡¥äº†ä¸€ç•ªï¼Œæå‡ºäº†YOLO v2æ¨¡å‹ã€‚å¹¶åŸºäºimagenetçš„åˆ†ç±»æ•°æ®é›†å’Œcocoçš„å¯¹è±¡æ£€æµ‹æ•°æ®é›†ï¼Œæå‡ºäº†wordnetæ¨¡å‹ï¼Œå¹¶æˆåŠŸçš„æå‡ºäº†YOLO9000æ¨¡å‹ã€‚è¿™é‡Œæš‚æ—¶åªè®²YOLO v2.
ä½œè€…è¯´yolo v1ç›¸æ¯”è¾ƒå…¶ä»–åŸºäºåŒºåŸŸçš„æ¨¡å‹æ¯”å¦‚faster r-cnnè¿˜æ˜¯æœ‰äº›ä¸è¶³çš„ï¼Œæ¯”å¦‚æ›´å¤šå®šä½é”™è¯¯ï¼Œæ›´ä½å¬å›ç‡ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªç‰ˆæœ¬å¼€å§‹ä¸»è¦è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚

### 4.1 ä½œè€…å¯¹yolo v1çš„è¡¥ä¸

1 - åœ¨æ‰€æœ‰å·ç§¯å±‚ä¸Šç”¨BNï¼Œå¹¶æ‰”æ‰dropout

2 - yolo çš„è®­ç»ƒè¿‡ç¨‹ï¼ˆä¸¤ä¸ªç‰ˆæœ¬éƒ½æ˜¯ï¼‰ä¸ºï¼šåˆ†ç±»æ¨¡å‹çš„é¢„è®­ç»ƒå’Œæ£€æµ‹æ¨¡å‹çš„å¾®è°ƒã€‚ä½œè€…è§‰å¾—yolo v1çš„é¢„è®­ç»ƒä¸å¤Ÿå¥½ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ‹¿imagenetçš„åˆ†è¾¨ç‡ä¸º448âˆ—448çš„å›¾ç‰‡å¾®è°ƒ10ä¸ªepochï¼Œç„¶ååœ¨å°†å‰é¢çš„å·ç§¯å±‚ç•™å¾…æ£€æµ‹æ¨¡å‹ç”¨ã€‚

3 - ä½¿ç”¨anchor boxï¼ˆè€Œè¿™å‡ ä¸ªanchor boxæ˜¯åŸºäºè®­ç»ƒé›†æ•°æ®çš„æ ‡ç­¾ä¸­ğ‘¤,â„èšç±»å‡ºæ¥çš„ï¼‰ï¼ŒåŠ å¿«æ¨¡å‹æ”¶æ•›

4 - å»æ‰å…¨è¿æ¥å±‚ï¼Œæ‰”æ‰æœ€åä¸€å±‚æ± åŒ–å±‚ï¼Œå¹¶ä¸”å°†ç½‘ç»œçš„è¾“å…¥ç«¯resizeä¸º416âˆ—416ï¼Œä»è€Œè¾“å‡ºçš„æ˜¯ä¸€ä¸ª13âˆ—13âˆ—ğ‘â„ğ‘ğ‘›ğ‘›ğ‘’ğ‘™çš„å·ç§¯å±‚

5 - åœ¨é¢„æµ‹ğ‘¥,ğ‘¦,ğ‘¤,â„çš„æ—¶å€™æ˜¯åŸºäºanchor box,ä¸”ä¸RPNç•¥æœ‰ä¸åŒçš„æ–¹æ³•å»é¢„æµ‹ã€‚

6 - åŠ äº†ä¸€ä¸ªpassthroughå±‚

### 4.2 åŸºç¡€ç½‘ç»œ

YOLOv2ç”¨çš„æ˜¯Darknet-19ç½‘ç»œç”¨äºç‰¹å¾æå–çš„ã€‚ä½œè€…åœ¨è®ºæ–‡ä¸­è¿™æ ·è¯´åˆ°ï¼š**å…¶å®å¾ˆå¤šæ£€æµ‹æ¡†æ¶éƒ½æ˜¯ä¾èµ–äºVGG-16ç½‘ç»œæ¥æå–ç‰¹å¾çš„**ï¼ŒVGG-16æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ï¼Œå‡†ç¡®ç‡é«˜çš„åˆ†ç±»ç½‘ç»œï¼Œä½†æ˜¯å®ƒå¾ˆå¤æ‚ã€‚çœ‹æ²¡çœ‹åˆ°ï¼Œä½œè€…ç”¨äº†ä¸€ä¸ªâ€œä½†æ˜¯â€å°±æŠŠè¿™ä¸ªç½‘ç»œå¦å®šäº†ï¼Œç„¶åè‡ªå·±ç‰›é€¼çš„æå‡ºäº†ä¸€ä¸ªæ¯”å®ƒä¼˜ç§€çš„ç½‘ç»œã€‚ä½œè€…ç»§ç»­è¡¥åˆ€ï¼šä»…ä¸€å¼ åˆ†è¾¨ç‡ä¸º224\*224çš„å›¾ç‰‡åœ¨å•æ¬¡ä¼ é€’çš„æ—¶å€™,VGG-16çš„å·ç§¯å±‚å°±éœ€è¦30.69 billionæ¬¡æµ®ç‚¹è¿ç®—æ“ä½œã€‚çœ‹ä¸€å¼ ç½‘ç»œè¿ç®—æµ®ç‚¹æ“ä½œçš„å›¾å°±çŸ¥é“äº†ï¼Œåæ­£ä½ çŸ¥é“VGG-16è¿ç®—é‡å¾ˆå¤§å°±è¡Œäº†ã€‚



â€‹          ![img](imgs/750.png)



æˆ‘è§£é‡Šä¸€ä¸‹ï¼Œç›®æ ‡æ£€æµ‹ç½‘ç»œåœ¨è®­ç»ƒä¹‹å‰éƒ½è¦ç”¨å•ç‹¬çš„ç½‘ç»œæ¥ä¸æå–ç‰¹å¾ï¼Œè¿›è¡Œé¢„è®­ç»ƒï¼Œç„¶åç‰¹å¾æå–ä¹‹åå†åœ¨åé¢åŠ ä¸Šè‡ªå·±çš„åˆ›é€ çš„ç›®æ ‡æ£€æµ‹ç½‘ç»œï¼ˆä¸€ç³»åˆ—å·ç§¯å±‚ç­‰ï¼‰ï¼Œå®Œæˆç›®æ ‡æ£€æµ‹ã€‚ä¹‹å‰çš„YOLOv1ç”¨çš„ç‰¹å¾æå–ç½‘ç»œæ˜¯GoogLeNedçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œå›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè®¡ç®—é‡æ˜¯8.52G-ops,top-5å‡†ç¡®ç‡æ˜¯88.0%ï¼ŒVGG-16ç½‘ç»œtop-5å‡†ç¡®ç‡æ˜¯90.0%ï¼ˆ30.69G-opsï¼‰ï¼Œæ³¨æ„å•¦ï¼Darknet-19ç½‘ç»œè®¡ç®—é‡æ˜¯**5.58G-ops,top-5å‡†ç¡®ç‡é«˜è¾¾91.2%ã€‚çœ‹ä¸€ä¸‹Darknet-19çš„ç»“æ„ï¼š**

ä¸ºäº†ç»“åˆGooglenetå’ŒVGGçš„ä¼˜åŠ¿ï¼Œä½œè€…æå‡ºäº†å›¾1è¿™æ ·ä¸€ç§ç½‘ç»œç»“æ„ï¼Œå°†å…¶ä½œä¸ºyoloåˆ†ç±»æ¨¡å‹çš„åŸºç¡€æ¨¡å‹ã€‚

![img](imgs/700.png)

å›¾1.darknet-19

ä¸Šå›¾å°±æ˜¯darknet-19ï¼Œä½œè€…å…ˆåœ¨imagenetä¸Šä»¥224âˆ—224å…ˆåˆå§‹åŒ–è®­ç»ƒï¼Œç„¶åç”¨448âˆ—448çš„åˆ†è¾¨ç‡å›¾ç‰‡è·‘10ä¸ªepochã€‚è·‘å®Œä¹‹åï¼Œä¸¢å¼ƒæœ€åçš„å·ç§¯å±‚å’Œå…¨å±€æ± åŒ–å±‚ï¼Œæ¢ä¸Š3ä¸ª3âˆ—3âˆ—1024çš„å·ç§¯å±‚ï¼Œç„¶åè·Ÿä¸€å±‚1*1çš„å·ç§¯å±‚ï¼Œæœ€åè¾“å‡º13âˆ—13âˆ—125,å¦‚ä¸‹å›¾æ‰€ç¤º

![img](imgs/441382-20170822145228089-1360410243.png)

å›¾2.yolov2ç½‘ç»œç»“æ„å›¾

å†è¯¦ç»†çœ‹ä¸€ä¸‹åœ¨Darknet-19çš„åŸºç¡€ä¸Šçš„YOLOv2ç½‘ç»œç»“æ„ï¼š



â€‹       ![img](imgs/7000.png)

â€‹                       

YOLO2ç½‘ç»œä¸­ç¬¬23å±‚ä¸Šé¢æ˜¯Darknet-19ç½‘ç»œï¼Œåé¢æ˜¯æ·»åŠ çš„æ£€æµ‹ç½‘ç»œã€‚

YOLO 2é‡‡ç”¨ç¥ç»ç½‘ç»œç»“æ„ï¼Œæœ‰32å±‚ã€‚ç»“æ„æ¯”è¾ƒå¸¸è§„ï¼ŒåŒ…å«ä¸€äº›å·ç§¯å’Œæœ€å¤§æ± åŒ–ï¼Œå…¶ä¸­æœ‰ä¸€äº›1\*1å·ç§¯ï¼Œé‡‡ç”¨GoogLeNetä¸€äº›**å¾®è§‚**çš„ç»“æ„ã€‚å…¶ä¸­è¦ç•™æ„çš„æ˜¯ï¼Œç¬¬25å±‚å’Œ28å±‚æœ‰ä¸€ä¸ªrouteã€‚ä¾‹å¦‚ç¬¬28å±‚çš„routeæ˜¯27å’Œ24ï¼Œå³æŠŠ27å±‚å’Œ24å±‚åˆå¹¶åˆ°ä¸€èµ·è¾“å‡ºåˆ°ä¸‹ä¸€å±‚ï¼Œrouteå±‚çš„ä½œç”¨æ˜¯è¿›è¡Œå±‚çš„åˆå¹¶ã€‚30å±‚è¾“å‡ºçš„å¤§å°æ˜¯13\*13ï¼Œæ˜¯æŒ‡æŠŠå›¾ç‰‡é€šè¿‡å·ç§¯æˆ–æ± åŒ–ï¼Œæœ€åç¼©å°åˆ°ä¸€ä¸ª13\*13å¤§å°çš„æ ¼ã€‚æ¯ä¸€ä¸ªæ ¼å­çš„outputå‚æ•°æ˜¯125ã€‚æ‰€ä»¥æœ€åè¾“å‡ºçš„å‚æ•°ä¸€å…±æ˜¯13\*13\*125

ä¸Šå›¾æ˜¯é€šè¿‡å®˜ç½‘darknetå‘½ä»¤ç”Ÿæˆçš„ç½‘ç»œç»“æ„ï¼Œä»ä¸­å¯ä»¥å‘ç°æœ‰å‡ ç‚¹ç–‘æƒ‘ï¼Œæ¯”å¦‚è®ºæ–‡ä¸­çš„passthroughåˆ°åº•æ˜¯ä»€ä¹ˆæ“ä½œï¼Ÿ

å›¾2ä¸­layer0-layer22å±‚å°±æ˜¯darknet-19çš„å‰é¢éƒ¨åˆ†ï¼Œï¼Œå…·ä½“å¯¹ç…§å¦‚ä¸‹å›¾ï¼š

![img](imgs/441382-20170822155559777-556200591.png)

å›¾3.darknet19åˆ°yolov2ç»“æ„çš„ç¤ºæ„å›¾

### 4.3 è®­ç»ƒ

yolov2æ¨¡å‹çš„è®­ç»ƒåŸºæœ¬å°±åˆ†ä¸‹é¢ä¸‰æ­¥ï¼š

iï¼‰é¦–å…ˆæ‹¿darknet19åœ¨imagenetä¸Šä»¥åˆ†è¾¨ç‡224âˆ—224è·‘160å›ï¼Œç„¶åä»¥åˆ†è¾¨ç‡448âˆ—448è·‘10å›;

iiï¼‰ç„¶åå¦‚ä¸Šé¢æ‰€ç¤ºï¼Œå°†darknet19ç½‘ç»œå˜æˆyolov2ç½‘ç»œç»“æ„ï¼Œå¹¶resizeè¾“å…¥ä¸º416âˆ—416

iiiï¼‰å¯¹å¢åŠ çš„å±‚éšæœºåˆå§‹åŒ–ï¼Œå¹¶æ¥ç€åœ¨å¯¹è±¡æ£€æµ‹æ•°æ®é›†ä¸Šè®­ç»ƒ160å›ï¼Œä¸”åœ¨ã€60ï¼Œ90ã€‘çš„æ—¶å€™é™ä½å­¦ä¹ ç‡

è€Œç¬¬ä¸‰æ­¥ä¸­ï¼Œå› ä¸ºv2çš„ç›®æ ‡å‡½æ•°å’Œå¢åŠ çš„anchor boxï¼Œè€Œä¸v1åœ¨æ¦‚å¿µä¸Šæœ‰æ‰€ä¸åŒã€‚

### 4.4  v2ä¸­è¾ƒéš¾ç†è§£çš„è¡¥ä¸

å¦‚å›¾2æ‰€ç¤ºï¼Œæœ€åä¼šè¾“å‡ºä¸€ä¸ª13âˆ—13âˆ—125çš„å¼ é‡,å…¶ä¸­çš„13âˆ—13å¦‚yolo v1ä¸€æ ·ï¼Œæ˜¯è¡¨ç¤ºç½‘æ ¼åˆ’åˆ†çš„æ„æ€ï¼Œåé¢çš„125å°±æ˜¯å½“å‰ç½‘æ ¼çš„æ“ä½œæ‰€åœ¨ã€‚ä¹‹å‰yolov1æ—¶ï¼Œä½œè€…æ‹¿äº†B=2ï¼Œè€Œè¿™é‡ŒB=5ï¼Œä¸”è¿™é‡Œçš„5ä¸ªé¢„æµ‹å€™é€‰æ¡†æ˜¯äº‹å…ˆå¾—åˆ°çš„ï¼ˆä¸‹é¢å¾…ç»­ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç»™å®šäº†5ä¸ªæ¡†çš„ğ‘¤,â„ï¼Œé¢„æµ‹å¾—åˆ°çš„æ˜¯5\*(4+1+20)ï¼Œåˆ†åˆ«ä¸ºğ‘¥,ğ‘¦,ğ‘¤,â„;ğ‘ğ‘œğ‘›ğ‘“ğ‘–ğ‘‘ğ‘’ğ‘›ğ‘ğ‘’;ğ‘ğ‘™ğ‘ğ‘ ğ‘ ã€‚

æ²¡é”™ï¼Œåœ¨yolo1çš„æ—¶å€™æ˜¯å‡ºç°2ä¸ªå€™é€‰æ¡†ï¼Œç„¶ååªæœ‰ä¸€æ¡20ç»´åº¦è¡¨ç¤ºç±»åˆ«ï¼Œè¿™é‡Œæ˜¯æ¯ä¸ªanchor boxéƒ½ä¼šæœ‰é¢„æµ‹ç±»åˆ«ï¼Œæ‰€ä»¥ç›¸å¯¹çš„ç›®æ ‡å‡½æ•°ä¼šç•¥æœ‰æ”¹åŠ¨ï¼Œä½œè€…è¯´äº†åœ¨v2è¿˜æ˜¯é¢„æµ‹ğ¼ğ‘‚ğ‘ˆğ‘¡ğ‘Ÿğ‘¢ğ‘¡â„ğ‘ğ‘Ÿğ‘’ğ‘‘å’ŒåŸºäºå½“å‰æœ‰å¯¹è±¡åŸºç¡€ä¸Šé¢„æµ‹ç±»åˆ«ğ‘ƒ(ğ‘ğ‘™ğ‘ğ‘ ğ‘ |ğ‘œğ‘ğ‘—ğ‘’ğ‘ğ‘¡)ã€‚

#### 4.4.1 anchor boxçš„ç”Ÿæˆ & åæ ‡é¢„æµ‹

**å…³äºYOLOv2 è¾¹æ¡†é¢„æµ‹è®¡ç®—ï¼š**  

ä¸Šé¢è¯´äº†æœ€åè¾“å‡ºå‚æ•°æ˜¯13\*13\*125,  æ˜¯å› ä¸ºä¸€å…±æœ‰13\*13ä¸ªæ ¼å­ï¼Œæ¯ä¸ªæ ¼å­é¢„æµ‹å‡º5ä¸ªbounding boxï¼Œæ¯ä¸ªbounding boxé¢„æµ‹25ä¸ªæ•°ï¼Œå…¶ä¸­20ä¸ªæ˜¯classçš„probabilityï¼Œå…¶ä½™5ä¸ªå‚æ•°ä¸­æœ‰å››ä¸ªè¡¨ç¤ºstxã€styã€twã€thï¼Œè¿™4ä¸ªæ¥è¯†åˆ«è¾¹æ¡†çš„ä½ç½®å’Œå¤§å°ï¼Œè¿˜æœ‰1ä¸ªæ•°æ˜¯confidenceï¼Œè¡¨ç¤ºè¾¹æ¡†é¢„æµ‹é‡Œæœ‰çœŸæ­£çš„å¯¹è±¡çš„æ¦‚ç‡ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯13\*13\*125ä¸ªæ•°ã€‚**æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å››ä¸ªå‚æ•°stxã€styã€twã€thï¼Œæ˜¯å¦‚ä½•é¢„æµ‹æ¡†çš„ä½ç½®çš„ã€‚**

è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ª**anchor boxes** æ¦‚å¿µï¼Œè¿™ä¸ªæ‚²ä¼¤çš„æ•…äº‹æ¥æºäºFaster RCNN,å› ä¸ºfaster RCNNä¸ºäº†ä¸è®©ç®—æ³•**æ¼«æ— ç›®çš„**çš„å»çŒœæµ‹é‚£äº›ç›®æ ‡çš„è¾¹æ¡†å¤§å°ï¼Œäºæ˜¯å°±è‡ªå·±é¢„å…ˆåœ¨æ¯ä¸ªä½ç½®ä¸Šäº§ç”Ÿä¸€å®šé•¿å®½æ¯”ä¾‹çš„æ–¹æ¡†ï¼Œä»¥å‡å°‘æœç´¢é‡ï¼Œè¿™ä¸ªæ–¹æ¡†å°±å«åšanchor boxesï¼Œanchorçš„æ„æ€æ˜¯â€œé”šâ€ï¼Œâ€œå›ºå®šâ€çš„æ„æ€ï¼Œå¤§å¤šæ•°äººæ˜¯æŠŠè¿™ä¸ªè§£é‡Šä¸ºâ€œé”šâ€ï¼Œä¸è¿‡æˆ‘è§‰å¾—è§£é‡Šæˆâ€œå›ºå®šâ€æ¯”è¾ƒå¥½ï¼Œå…¶å®ä¹Ÿæœ‰é”šçš„æ„æ€ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ç›¸å¯¹äºä¸­å¿ƒç‚¹æ¥è¯´çš„ï¼Œå°±æ˜¯åœ¨ä¸­å¿ƒç‚¹çš„å‘¨å›´äº§ç”Ÿå‡ ä¸ªå›ºå®šæ¯”ä¾‹çš„è¾¹æ¡†ï¼Œæ‰€ä»¥è¿™ä¸ªâ€œä¸­å¿ƒç‚¹â€å°±æŠŠè¿™å‡ ä¸ªæ¡†ç»™é”šä½äº†ï¼Œä»–ä»¬å…±ç”¨ä¸€ä¸ªä¸­å¿ƒç‚¹ï¼Œï¼ˆå½“ç„¶åœ¨YOLOv2ä¸­è¿™ä¸ªä¸­å¿ƒç‚¹æ˜¯ä¸€ä¸ªæ ¼å­çš„å¤§å°ï¼Œæ‰€ä»¥ä¼šåœ¨æ ¼å­é‡Œå¾®å°ç§»åŠ¨ï¼‰ã€‚

  faster rcnnåœ¨æ¯ä¸ªä½ç½®ä¸Šäº§ç”Ÿäº†9ä¸ªä¸åŒé•¿å®½æ¯”ä¾‹çš„anchor boxes ï¼Œè¿™å‡ ç§æ¯”ä¾‹ä»¥åŠæ¯”ä¾‹çš„ç§æ•°ä½œè€…è®¤ä¸ºä¸åˆç†ï¼Œæ˜¯æ‰‹åŠ¨é€‰å‡ºæ¥çš„ï¼Œè™½ç„¶ç½‘ç»œæœ€ç»ˆå¯ä»¥å­¦å‡ºæ¥ï¼Œä½†å¦‚æœæˆ‘ä»¬å¯ä»¥ç»™å‡ºæ›´å¥½çš„anchorï¼Œé‚£ä¹ˆç½‘ç»œè‚¯å®šæ›´åŠ å®¹æ˜“è®­ç»ƒè€Œä¸”æ•ˆæœæ›´å¥½ã€‚

äºæ˜¯ä½œè€…çµå…‰ä¸€é—ªï¼Œé€šè¿‡K-Meansèšç±»çš„æ–¹å¼åœ¨è®­ç»ƒé›†ä¸­èšå‡ºäº†å¥½çš„anchoræ¨¡æ¿ã€‚ç»è¿‡åˆ†æï¼Œç¡®å®šäº†anchor boxesçš„ä¸ªæ•°ä»¥åŠæ¯”ä¾‹ã€‚å¦‚ä¸‹å›¾

â€‹          ![img](imgs/60000.png)

 

ä¸Šå›¾çš„å·¦è¾¹å¯ä»¥çœ‹å‡ºï¼Œæœ‰5ä¸­ç±»å‹çš„é•¿å®½æ¯”ä¾‹ã€‚åé¢é¢„æµ‹å‡ºstxã€styã€twã€thï¼Œå››ä¸ªå‚æ•°ï¼Œå†æ ¹æ®ä¸Šå›¾å³è¾¹çš„è®¡ç®—å°±å¯ä»¥è®¡ç®—å‡ºé¢„æµ‹å‡ºçš„boxå¤§å°äº†ï¼Œæ³¨æ„ï¼ä¸Šå›¾å³è¾¹é‡Œé¢çš„Ïƒ(tx)å¯ä»¥ç†è§£ä¸ºstxï¼ŒÏƒ(ty)å¯ä»¥ç†è§£ä¸ºstyã€‚**æ¯ä¸€ä¸ªè¾“å‡ºçš„bboxæ˜¯é’ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„anchorï¼Œanchorå…¶å®æ˜¯bboxçš„widthåŠheightçš„ä¸€ä¸ªå‚è€ƒ**ã€‚**pwå’Œphæ˜¯æŸä¸ª**anchor boxçš„å®½å’Œé«˜ï¼Œä¸€ä¸ªæ ¼å­çš„Cxå’ŒCyå•ä½éƒ½æ˜¯1ï¼Œ**Ïƒ(tx)**ï¼Œ**Ïƒ(ty)**æ˜¯ç›¸å¯¹äºæŸä¸ªæ ¼å­å·¦ä¸Šè§’çš„åç§»é‡ã€‚

 è¿™ä¸ªåœ°æ–¹ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘é¢„æµ‹å‡ºäº†stxã€styã€twã€thå››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯0.2ï¼Œ0.1ï¼Œ0.2ï¼Œ0.32ï¼Œrowï¼š1ï¼Œcol:1å‡å¦‚anchoræ¯”ä¾‹å–ï¼šw:3.19275ï¼Œh:4.00944ï¼Œè¿™å…¶ä¸­rowå’Œcolå°±æ˜¯é”šç‚¹ç›¸å¯¹äºæ•´ä¸ªç½‘æ ¼çš„åç§»çš„æ ¼å­æ•°ï¼Œåœ¨è¿™ä¸ªåç§»é‡çš„åŸºç¡€ä¸Šè®¡ç®—æ ¼å­ä¸­å¿ƒä½ç½®,

 è®¡ç®—å‡º:

â€‹                                    bx=0.2+1=1.2

â€‹                                    by=0.1+1=1.1

â€‹                                    bw=3.19275*exp(0.2)=3.89963

â€‹                                    bh=4.00944*exp(0.32)=5.52151

ç„¶ååˆ†åˆ«å°†è¿™äº›å½’ä¸€åŒ–ï¼ˆåŒé™¤ä»¥13ï¼‰ï¼Œå¾—:bx=0.09,by=0.08,bw=0.30,bh=0.42.å…·ä½“æ˜¯å¦è¦è¾“å‡ºå½“å‰çš„è¾¹æ¡†ï¼Œå®ƒçš„æ¦‚ç‡ï¼Œè¿˜æœ‰ç”Ÿæˆçš„ç‰©ä½“çš„ç±»åˆ«ï¼Œè¿™ä¸ªå–å†³äºåé¢çš„probabilityå’Œconfidenceã€‚


â€‹            ![img](imgs/1000.png)

 Confidenceè¡¨ç¤ºæœ‰æ²¡æœ‰ç‰©ä½“ï¼Œå‡è®¾æœ‰ç‰©ä½“ä¹‹åï¼Œprobabilityè¡¨ç¤ºç‰©ä½“çš„æ¦‚ç‡ã€‚

é€šè¿‡å°†confidenceå’Œæœ€å¤§å¯èƒ½è¾“å‡ºçš„ç±»çš„probabilityç›¸ä¹˜ä¹‹åï¼Œè¦æ˜¯å¾—å‡ºçš„ç»“æœå¤§äºé—¨é™0.24ï¼Œå°±ä¼šè¾“å‡ºå½“å‰è®¡ç®—å‡ºçš„bboxçš„å¤§å°å’Œä½ç½®ï¼ŒåŒæ—¶ä¼šè¾“å‡ºæ˜¯å“ªä¸€ä¸ªç±»ï¼Œprobabilityå¤§å°æ˜¯å¤šå°‘ã€‚ä¸€å…±ä¼šç”Ÿæˆ13\*13\*5ä¸ªbboxï¼Œç„¶åæ ¹æ®probabilityï¼Œé€šè¿‡filterï¼Œäº§ç”Ÿå‡ºæœ€åé¢„æµ‹çš„ç‰©ä½“å’Œå…¶è¾¹æ¡†ã€‚

â€‹                   ![img](imgs/100.png)

â€‹         ![img](imgs/100000.png)

ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æœ€å‰é¢é‚£ä¸ªæœ‰ç‹—ï¼Œæœ‰è½¿è½¦ï¼Œæœ‰è‡ªè¡Œè½¦çš„å›¾åƒï¼Œæ¯”è¾ƒå›¾ä¸­æœ€åçš„ä¸‰è¡Œå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œé‡Œé¢æœ‰è½¿è½¦ï¼Œç‹—å’Œè‡ªè¡Œè½¦ï¼Œä¹Ÿèƒ½çœ‹åˆ°probabilityå’Œbboxåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ¦‚ç‡ã€å¤§å°å’Œä½ç½®ã€‚å…·ä½“æ¥è®²ï¼Œä»ç¬¬ä¸€è¡Œï¼Œå¯ä»¥çœ‹å‡ºè½¿è½¦çš„class_idä¸º6ï¼Œé€šè¿‡rowå’Œcolå¯ä»¥çœ‹å‡ºå¤§æ¦‚çš„ä½ç½®ï¼Œè¿˜ç»™å‡ºäº†anchor_idã€‚ç¬¬äºŒè¡Œå¯ä»¥çœ‹åˆ°è½¿è½¦çš„confidenceå’Œstxã€‚**ä½ å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„è®¡ç®—å…¬å¼è®¡ç®—ä¸€ä¸‹æ˜¯å¦æ­£ç¡®ï¼ˆåé¢è¾“å‡ºçš„æ—¶å€™ä¼šæœ‰ä¸€ç‚¹ç‚¹å°çš„resizeï¼‰ã€‚**

å…¶å®è¿™äº›é€šè¿‡stxã€styã€twã€thè®¡ç®—boxçš„ä½ç½®æ˜¯æ£€æµ‹çš„æ—¶å€™æ‰è®¡ç®—çš„ï¼Œè®­ç»ƒçš„æ—¶å€™æ˜¯ç”¨stxã€styã€twã€thè¿›è¡ŒæŸå¤±è®¡ç®—çš„ã€‚

> å¦‚è®ºæ–‡ä¸­æ‰€è¯´ï¼Œç›¸å¯¹å…¶ä»–rpnç½‘ç»œï¼Œyolo v2çš„äº‹å…ˆå‡†å¤‡çš„å‡ ä¸ªé¢„æµ‹å€™é€‰æ¡†ï¼ˆä¹Ÿå«åšanchor boxï¼‰å¤§å°æ˜¯åŸºäºè®­ç»ƒé›†ç®—å‡ºæ¥çš„ã€‚å¦‚[ä½œè€…ä»£ç ](https://github.com/pjreddie/darknet/blob/master/cfg/yolo-voc.2.0.cfg)
> ä¸­ï¼š
>
> ```
> [region]
> anchors = 1.08,1.19,  3.42,4.41,  6.63,11.38,  9.42,5.11,  16.62,10.52
> bias_match=1
> classes=20
> coords=4
> num=5
> ```
>
> ä¸Šè¿°ä»£ç ä¸­anchorsä¿å­˜çš„å°±æ˜¯å„è‡ªçš„widthå’Œheightï¼Œä¹Ÿå°±æ˜¯è®ºæ–‡ä¸­çš„ç¬¦å·ğ‘ğ‘¤,ğ‘â„ã€‚
>
> åŸç†å°±æ˜¯åŸºäºæ‰€æœ‰è®­ç»ƒé›†çš„æ ‡ç­¾ä¸­ï¼Œå…ˆè®¡ç®—å¾—å‡ºæ‰€æœ‰çš„widthå’Œå¯¹åº”çš„heightï¼Œå°†å…¶ä½œä¸ºæ ·æœ¬ï¼Œé‡‡ç”¨kmeançš„æ–¹æ³•ï¼Œåªä¸è¿‡è·ç¦»å‡½æ•°æ¢æˆäº†ğ‘‘(ğ‘ğ‘œğ‘¥,ğ‘ğ‘’ğ‘›ğ‘¡ğ‘’ğ‘Ÿ)=1âˆ’ğ¼ğ‘‚ğ‘ˆ(ğ‘ğ‘œğ‘¥,ğ‘ğ‘’ğ‘›ğ‘¡ğ‘’ğ‘Ÿ)
>
> è¿™é‡Œéœ€è¦5ä¸ªanchorï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°5ä¸ªä¸åŒæ ·æœ¬ä¸­å¿ƒï¼Œè®°å¾—ä¹˜ä»¥ï¼ˆ32/416ï¼‰ï¼›å‡è®¾é”šç‚¹å€¼ä¸ºxï¼Œåˆ™$\frac{ğ‘¥}{ğ‘ğ‘’ğ‘›ğ‘¡ğ‘’ğ‘Ÿğ‘–ğ‘‘ğ‘ }=\frac{32}{416}$
>
> å¦‚5ä¸ªæ ·æœ¬ä¸­å¿ƒï¼š
>
> ```
> [[ 103.84071465   29.09785553]
> [  40.14028782   21.66632026]
> [ 224.79420059  102.18148749]
> [  61.79184575   39.21399017]
> [ 126.37797981   60.03186796]]
> ```
>
> å¯¹åº”çš„é”šç‚¹ï¼š
>
> ```
> 7.98774728074, 2.23829657922,      3.08771444772, 1.66664002,     17.2918615841, 7.86011442226,     4.75321890422, 3.01646078194,     9.72138306269, 4.61783599681
> ```



#### 4.4.3  passthroughæ“ä½œ

é€šè¿‡githubæ‰¾åˆ°staræœ€å¤šçš„[yolo 2-pytorch](https://github.com/longcw/yolo2-pytorch)ï¼Œç ”è¯»äº†éƒ¨åˆ†ä»£ç ï¼Œæ‰¾åˆ°å¦‚ä¸‹éƒ¨åˆ†ï¼š

```darknet.py
#darknet.py
        self.reorg = ReorgLayer(stride=2)   # stride*stride times the channels of conv1s
#reorg_layer.py
    def forward(self, x): 
        stride = self.stride

        bsize, c, h, w = x.size()
        out_w, out_h, out_c = int(w / stride), int(h / stride), c * (stride * stride)
        out = torch.FloatTensor(bsize, out_c, out_h, out_w)

        if x.is_cuda:
            out = out.cuda()
            reorg_layer.reorg_cuda(x, out_w, out_h, out_c, bsize, stride, 0, out)
        else:
            reorg_layer.reorg_cpu(x, out_w, out_h, out_c, bsize, stride, 0, out)

        return out 
//reorg_cpu.c
int reorg_cpu(THFloatTensor *x_tensor, int w, int h, int c, int batch, int stride, int forward, THFloatTensor *out_tensor)
{
    // Grab the tensor
    float * x = THFloatTensor_data(x_tensor);
    float * out = THFloatTensor_data(out_tensor);

    // https://github.com/pjreddie/darknet/blob/master/src/blas.c
    int b,i,j,k;
    int out_c = c/(stride*stride);

    for(b = 0; b < batch; ++b){
        //batch_size
        for(k = 0; k < c; ++k){
           //channel
            for(j = 0; j < h; ++j){
                //height
                for(i = 0; i < w; ++i){
                    //width
                    int in_index  = i + w*(j + h*(k + c*b));
                    int c2 = k % out_c;
                    int offset = k / out_c;
                    int w2 = i*stride + offset % stride;
                    int h2 = j*stride + offset / stride;
                    int out_index = w2 + w*stride*(h2 + h*stride*(c2 + out_c*b));
                    if(forward) out[out_index] = x[in_index];
                    else out[in_index] = x[out_index];
                }
            }
        }
    }

    return 1;
}
```

ä»ä¸Šè¿°cä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡ŒReorgLayerå±‚å°±æ˜¯å°†26âˆ—26âˆ—51226âˆ—26âˆ—512çš„å¼ é‡ä¸­26âˆ—2626âˆ—26åˆ‡å‰²æˆ4ä¸ª13âˆ—1313âˆ—13ç„¶åè¿æ¥èµ·æ¥ï¼Œä½¿å¾—åŸæ¥çš„512é€šé“å˜æˆäº†2048ã€‚

#### 4.4.5 ç›®æ ‡å‡½æ•°è®¡ç®—

**å…³äºæŸå¤±å‡½æ•°ï¼š**

![img](imgs/2000.png)



å‰é¢è®²çš„æ˜¯forwardçš„è¿‡ç¨‹ï¼Œå³ç»™äº†ä¸€ä¸ªå›¾åƒå’Œç¥ç»ç½‘ç»œï¼Œæ€ä¹ˆå¾—åˆ°è¯†åˆ«çš„ç‰©ä½“æ¦‚ç‡å’Œä½ç½®ã€‚é‚£ä¹ˆå…·ä½“çš„è®­ç»ƒè¿‡ç¨‹æ˜¯å¦‚ä½•çš„å‘¢ï¼Œæ€ä¹ˆå»è¿›è¡Œè®­ç»ƒï¼Ÿè®ºæ–‡äº†ä¸­ç»™äº†ä¸€ä¸ªæŸå¤±å‡½æ•°ã€‚è¦æ˜¯ç»™äºˆä¸€ä¸ªåˆé€‚çš„æŸå¤±å‡½æ•°ï¼Œç»™ä¸€å®šçš„æ•°æ®å»è®­ç»ƒï¼Œé‚£ä¹ˆç¥ç»ç½‘ç»œå°±ä¼šå¾—åˆ°å¥½çš„è¡¨ç°ã€‚

è¿›è¡Œè®­ç»ƒçš„ä¸€å…±æœ‰å››ç±»lossï¼Œä»–ä»¬weightä¸åŒï¼Œåˆ†åˆ«æ˜¯objectã€noobjectã€classã€coordã€‚æ€»ä½“lossæ˜¯å››ä¸ªéƒ¨åˆ†çš„å¹³æ–¹å’Œã€‚

åŒæ ·é€šè¿‡githubä¸Šç°æœ‰çš„æœ€å¤šstarsçš„é‚£ä»½ä»£ç ï¼Œæ‰¾åˆ°å¯¹åº”çš„æŸå¤±è®¡ç®—éƒ¨åˆ†

```darknet.py
#darknet.py
    def loss(self):
        #å¯ä»¥çœ‹å‡ºï¼ŒæŸå¤±å€¼ä¹Ÿæ˜¯åŸºäºé¢„æµ‹æ¡†bboxï¼Œé¢„æµ‹çš„iouï¼Œåˆ†ç±»ä¸‰ä¸ªä¸åŒçš„è¯¯å·®å’Œ
        return self.bbox_loss + self.iou_loss + self.cls_loss

    def forward(self, im_data, gt_boxes=None, gt_classes=None, dontcare=None):
        conv1s = self.conv1s(im_data)
        conv2 = self.conv2(conv1s)
        conv3 = self.conv3(conv2)
        conv1s_reorg = self.reorg(conv1s)
        cat_1_3 = torch.cat([conv1s_reorg, conv3], 1)
        conv4 = self.conv4(cat_1_3)
        conv5 = self.conv5(conv4)   # batch_size, out_channels, h, w
        â€¦â€¦
        â€¦â€¦
        # tx, ty, tw, th, to -> sig(tx), sig(ty), exp(tw), exp(th), sig(to)
        '''é¢„æµ‹tx ty'''
        xy_pred = F.sigmoid(conv5_reshaped[:, :, :, 0:2])
        '''é¢„æµ‹tw th '''
        wh_pred = torch.exp(conv5_reshaped[:, :, :, 2:4])
        bbox_pred = torch.cat([xy_pred, wh_pred], 3)
        '''é¢„æµ‹ç½®ä¿¡åº¦to '''
        iou_pred = F.sigmoid(conv5_reshaped[:, :, :, 4:5])
        '''é¢„æµ‹åˆ†ç±»class  '''
        score_pred = conv5_reshaped[:, :, :, 5:].contiguous()
        prob_pred = F.softmax(score_pred.view(-1, score_pred.size()[-1])).view_as(score_pred)

        # for training
        if self.training:
            bbox_pred_np = bbox_pred.data.cpu().numpy()
            iou_pred_np = iou_pred.data.cpu().numpy()
            _boxes, _ious, _classes, _box_mask, _iou_mask, _class_mask = self._build_target(
                                         bbox_pred_np, gt_boxes, gt_classes, dontcare, iou_pred_np)
            _boxes = net_utils.np_to_variable(_boxes)
            _ious = net_utils.np_to_variable(_ious)
            _classes = net_utils.np_to_variable(_classes)
            box_mask = net_utils.np_to_variable(_box_mask, dtype=torch.FloatTensor)
            iou_mask = net_utils.np_to_variable(_iou_mask, dtype=torch.FloatTensor)
            class_mask = net_utils.np_to_variable(_class_mask, dtype=torch.FloatTensor)

            num_boxes = sum((len(boxes) for boxes in gt_boxes))

            # _boxes[:, :, :, 2:4] = torch.log(_boxes[:, :, :, 2:4])
            box_mask = box_mask.expand_as(_boxes)
            #è®¡ç®—é¢„æµ‹çš„å¹³å‡bboxæŸå¤±å€¼
            self.bbox_loss = nn.MSELoss(size_average=False)(bbox_pred * box_mask, _boxes * box_mask) / num_boxes
           #è®¡ç®—é¢„æµ‹çš„å¹³å‡iouæŸå¤±å€¼
            self.iou_loss = nn.MSELoss(size_average=False)(iou_pred * iou_mask, _ious * iou_mask) / num_boxes
           #è®¡ç®—é¢„æµ‹çš„å¹³å‡åˆ†ç±»æŸå¤±å€¼
            class_mask = class_mask.expand_as(prob_pred)
            self.cls_loss = nn.MSELoss(size_average=False)(prob_pred * class_mask, _classes * class_mask) / num_boxes

        return bbox_pred, iou_pred, prob_pred
```

å¯ä»¥ä»ä¸Šè¿°ä»£ç çª¥è§ä¸€æ–‘ï¼Œyolo v2çš„ç›®æ ‡å‡½æ•°å’Œyolo v1åœ¨æ¦‚å¿µåŠç»“æ„ä¸Šç›¸å·®æ— å‡ ã€‚





â€‹            ![img](imgs/70)

â€‹                       Confidenceè¡¨ç¤ºæœ‰æ²¡æœ‰ç‰©ä½“ï¼Œå‡è®¾æœ‰ç‰©ä½“ä¹‹åï¼Œprobabilityè¡¨ç¤ºç‰©ä½“çš„æ¦‚ç‡ã€‚

â€‹     é€šè¿‡å°†confidenceå’Œæœ€å¤§å¯èƒ½è¾“å‡ºçš„ç±»çš„probabilityç›¸ä¹˜ä¹‹åï¼Œè¦æ˜¯å¾—å‡ºçš„ç»“æœå¤§äºé—¨é™0.24ï¼Œå°±ä¼šè¾“å‡ºå½“å‰è®¡ç®—å‡ºçš„bboxçš„å¤§å°å’Œä½ç½®ï¼ŒåŒæ—¶ä¼šè¾“å‡ºæ˜¯å“ªä¸€ä¸ªç±»ï¼Œprobabilityå¤§å°æ˜¯å¤šå°‘ã€‚ä¸€å…±ä¼šç”Ÿæˆ13*13*5ä¸ªbboxï¼Œç„¶åæ ¹æ®probabilityï¼Œé€šè¿‡filterï¼Œäº§ç”Ÿå‡ºæœ€åé¢„æµ‹çš„ç‰©ä½“å’Œå…¶è¾¹æ¡†ã€‚

â€‹                   ![img](imgs/70000.png)

â€‹         ![img](imgs/asdfasdf.png)

â€‹     ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æœ€å‰é¢é‚£ä¸ªæœ‰ç‹—ï¼Œæœ‰è½¿è½¦ï¼Œæœ‰è‡ªè¡Œè½¦çš„å›¾åƒï¼Œæ¯”è¾ƒå›¾ä¸­æœ€åçš„ä¸‰è¡Œå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œé‡Œé¢æœ‰è½¿è½¦ï¼Œç‹—å’Œè‡ªè¡Œè½¦ï¼Œä¹Ÿèƒ½çœ‹åˆ°probabilityå’Œbboxåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ¦‚ç‡ã€å¤§å°å’Œä½ç½®ã€‚å…·ä½“æ¥è®²ï¼Œä»ç¬¬ä¸€è¡Œï¼Œå¯ä»¥çœ‹å‡ºè½¿è½¦çš„class_idä¸º6ï¼Œé€šè¿‡rowå’Œcolå¯ä»¥çœ‹å‡ºå¤§æ¦‚çš„ä½ç½®ï¼Œè¿˜ç»™å‡ºäº†anchor_idã€‚ç¬¬äºŒè¡Œå¯ä»¥çœ‹åˆ°è½¿è½¦çš„confidenceå’Œstxã€‚**ä½ å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„è®¡ç®—å…¬å¼è®¡ç®—ä¸€ä¸‹æ˜¯å¦æ­£ç¡®ï¼ˆåé¢è¾“å‡ºçš„æ—¶å€™ä¼šæœ‰ä¸€ç‚¹ç‚¹å°çš„resizeï¼‰ã€‚**

å…¶å®è¿™äº›é€šè¿‡stxã€styã€twã€thè®¡ç®—boxçš„ä½ç½®æ˜¯æ£€æµ‹çš„æ—¶å€™æ‰è®¡ç®—çš„ï¼Œè®­ç»ƒçš„æ—¶å€™æ˜¯ç”¨stxã€styã€twã€thè¿›è¡ŒæŸå¤±è®¡ç®—çš„ã€‚
