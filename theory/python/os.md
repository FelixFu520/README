# OSæ¨¡å—

âŒšï¸:2020å¹´11æœˆ30æ—¥

ðŸ“šå‚è€ƒ

---

> os é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸Žæ“ä½œç³»ç»Ÿç›¸å…³çš„æ ‡å‡†åº“ã€‚å¦‚ï¼šæ–‡ä»¶ï¼Œç›®å½•ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ã€‚

## 1. å¯¼å…¥æ¨¡å—

os æ˜¯ python æ ‡å‡†åº“æ¨¡å—ï¼Œéš python ä¸€èµ·å®‰è£…ï¼Œæ— éœ€å•ç‹¬å®‰è£…ï¼Œå¯ç›´æŽ¥å¯¼å…¥ã€‚

```python
import os
```

## 2. path å­æ¨¡å—

æ¶‰åŠä¸Žç£ç›˜æ–‡ä»¶æ“ä½œï¼Œæœ€å¸¸ä½¿ç”¨çš„å½“å±ž `path` æ¨¡å—äº†ã€‚`path` æ˜¯ `os` çš„å­æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ `from os import path` ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥é€šè¿‡ `os.path` å±žæ€§çš„æ–¹å¼ä½¿ç”¨ã€‚æœ¬æ–‡ï¼Œä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œç»Ÿä¸€é‡‡ç”¨åŽè€…çš„ä¹¦å†™å½¢å¼ã€‚

### 2.1 exists(path)

æ£€æµ‹æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚å­˜åœ¨è¿”å›ž `True` , ä¸å­˜åœ¨è¿”å›ž `False` ã€‚

```python
os.path.exists("dog.jpeg")
True
```

### 2.2 isfile(path)

åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶ã€‚æ˜¯è¿”å›ž `True`ï¼Œ ä¸æ˜¯è¿”å›ž `False`ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

```python
os.path.isfile("dogs/")
False
```

### 2.3 isdir(path)

åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½•ã€‚æ˜¯è¿”å›ž `True`ï¼Œ ä¸æ˜¯è¿”å›ž `False`ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚

```python
os.path.isdir("dogs/")
True
```

### 2.4 basename(path)

è¿”å›žä¸åŒ…å«æ‰€åœ¨ç›®å½•çš„æ–‡ä»¶åï¼ˆå«æ‰©å±•ï¼‰ã€‚

```python
os.path.basename("dir1/dir2/file.ext")
'file.ext'
```

### 2.5 dirname(path)

è¿”å›žæ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚

```python
os.path.dirname("dir1/dir2/file.ext")
'dir1/dir2'
```

### 2.6 split(path)

è¿”å›žä¸€ä¸ªå…ƒç»„ã€‚å…ƒç»„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ–‡ä»¶åï¼ˆå«æ‰©å±•ï¼‰ã€‚ç­‰æ•ˆäºŽ `(dirname(path), basename(path))`ã€‚

```python
os.path.split("dir1/dir2/file.ext")
('dir1/dir2', 'file.ext')
```

### 2.7 splitext(path)

è¿”å›žä¸€ä¸ªå…ƒç»„ã€‚å…ƒç»„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæ–‡ä»¶æ‰€åœ¨ç›®å½•å’Œæ–‡ä»¶åï¼ˆä¸å«æ‰©å±•ï¼‰ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ‰©å±•åï¼ˆåŒ…å« `.`ï¼‰ã€‚å¸¸ç”¨æ¥è¯»å–æˆ–æ›´æ”¹æ–‡ä»¶æ‰©å±•åã€‚

```python
os.path.splitext("dir1/dir2/file.ext")
('dir1/dir2/file', '.ext')
```

### 2.8 join(path, *paths)

å°†è·¯å¾„ä¸åŒéƒ¨åˆ†æ‹¼æŽ¥æˆä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ã€‚ç­‰æ•ˆäºŽ `os.sep.join([path, *paths])` ã€‚

```python
os.path.join("dir1", "dir2", "file.ext")
'dir1/dir2/file.ext'
```

### 2.9 getsize(path)

è¿”å›žæ–‡ä»¶å¤§å°ã€‚å•ä½å­—èŠ‚ã€‚

```python
os.path.getsize("dog.jpeg")
18335
```

## 3 ç›®å½•æ“ä½œ

### 3.1 listdir(path='.')

è¿”å›žä¸€ä¸ªåˆ—è¡¨ã€‚åˆ—è¡¨ä¸ºç»™å®šç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼Œä½†ä¸åŒ…å«ç‰¹æ®Šç›®å½• `.` å’Œ `..`ã€‚é»˜è®¤ä¸ºå½“å‰ç›®å½•ã€‚

```python
os.listdir("dogs")[:5]
['122.Pointer', '069.French_bulldog', '124.Poodle', '112.Nova_scotia_duck_tolling_retriever', '043.Canaan_dog']
```

### 3.2 mkdir(path, mode=0o777)

åˆ›å»ºåä¸º `path` çš„ç›®å½•ã€‚å¹¶ä»¥æ•°å­—å½¢å¼æŒ‡å®šç›®å½•æƒé™ï¼Œé»˜è®¤æƒé™ä¸º 777 ã€‚

```python
os.mkdir("newdir")
```

### 3.3 makedirs(path, mode=0o777)

é€’å½’æ–¹å¼åˆ›å»ºè·¯å¾„ä¸º `path` çš„ç›®å½•ã€‚å¹¶ä»¥æ•°å­—å½¢å¼æŒ‡å®šç›®å½•æƒé™ï¼Œé»˜è®¤æƒé™ä¸º 777 ã€‚å¯ä»¥çœ‹ä½œåŠŸèƒ½æ›´å¼ºå¤§çš„ `mkdir`ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºå¶å­èŠ‚ç‚¹ç›®å½•çš„æ‰€æœ‰ä¸Šçº§ç›®å½•ï¼Œè€Œ `mkdir` å¿…é¡»åœ¨ä¸Šçº§ç›®å½•å·²ç»å­˜åœ¨æƒ…å†µä¸‹ï¼Œæ‰èƒ½åˆ›å»ºå¶å­èŠ‚ç‚¹çš„ç›®å½•ã€‚

```python
os.makedirs("parent/child/newdir")
```

### 3.4 rmdir(path)

åˆ é™¤ç›®å½•ã€‚ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå¹¶ä¸”åªèƒ½åˆ é™¤ç©ºç›®å½•ã€‚ä¸å­˜åœ¨æˆ–ä¸ä¸ºç©ºï¼Œéƒ½ä¼šå¼‚å¸¸ã€‚è¦æƒ³é€’å½’åˆ é™¤æ•´ä¸ªç›®å½•æ ‘ï¼Œè¯·ä½¿ç”¨ [shutil.rmtree()](https://link.zhihu.com/?target=https%3A//docs.python.org/zh-cn/3/library/shutil.html%23shutil.rmtree)ã€‚

```python
os.rmdir("newdir")
```

### 3.5 removedirs(path)

é€’å½’åˆ é™¤ç›®å½•ã€‚ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå¹¶ä¸”åªèƒ½åˆ é™¤ç©ºç›®å½•ã€‚ä¸å­˜åœ¨æˆ–ä¸ä¸ºç©ºï¼Œéƒ½ä¼šå¼‚å¸¸ã€‚ä¸Ž `rmdir`ä¸åŒçš„æ˜¯ï¼Œåœ¨åˆ é™¤äº†å¶å­èŠ‚ç‚¹ç›®å½•åŽï¼Œä¼šé€æ¬¡åˆ é™¤ä¸Šçº§ç›®å½•ï¼Œç›´åˆ°é‡åˆ°ä¸ä¸ºç©ºçš„ç›®å½•ã€‚

```python
os.removedirs("parent/child/newdir")
```

### *3.6 remove(path)*

åˆ é™¤æ–‡ä»¶ã€‚ä¸èƒ½åˆ é™¤ç›®å½•ï¼Œç»™å®šè·¯å¾„å¿…é¡»ä¸ºæ–‡ä»¶ï¼Œå¦åˆ™ä¼šå¼‚å¸¸ã€‚

*Warm Suggestion*: ä»¥ä¸‹å¤åˆ¶æ–‡ä»¶çš„æ“ä½œï¼ŒæŽ¨èä½¿ç”¨ [shutil.copyfile](https://link.zhihu.com/?target=https%3A//docs.python.org/zh-cn/3/library/shutil.html%3Fhighlight%3Dshutil%23module-shutil)ã€‚

```python
# å¤åˆ¶æ–‡ä»¶
with open("dog.jpeg", "rb") as f:    
    content = f.read()    
    with open("dog.copy.jpeg", "wb") as f2:        
        f2.write(content)
        # åˆ é™¤æ–‡ä»¶
        os.remove("dog.copy.jpeg")
```

## 4. å…¶ä»– os æŽ¥å£

### 4.1 getenv(key, default=None)

èŽ·å–çŽ¯å¢ƒå˜é‡ã€‚

```python
os.getenv("PATH")
'/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin'
```

### 4.2 get_exec_path(env=None)

è¿”å›žç”¨äºŽæœç´¢å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•åˆ—è¡¨ã€‚çœ‹ä»¥çœ‹ä½œæ˜¯ `PATH` çŽ¯å¢ƒå˜é‡çš„åˆ—è¡¨å½¢å¼ã€‚

```python
os.get_exec_path()
['/usr/local/bin', '/usr/bin', '/bin', '/usr/sbin', '/sbin']
```

### 4.3 system(command)

åœ¨å½“å‰è¿›ç¨‹ä¸­ï¼Œå¯åŠ¨å­è¿›ç¨‹ï¼Œæ‰§è¡Œå‘½ä»¤ commandï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œä¸»è¿›ç¨‹ä¼šé˜»å¡žï¼Œç›´åˆ°å­è¿›ç¨‹æ‰§è¡Œå®Œæˆã€‚è¿™æ˜¯é€šè¿‡è°ƒç”¨æ ‡å‡†Cå‡½æ•° `system()` æ¥å®žçŽ°çš„ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åŒçš„é™åˆ¶ã€‚

```python
if os.name == "nt":    
    command = "dir"
else:    
    command = "ls -l"os.system(command)0
```

### 4.4 os.walk()

pythonä¸­os.walkæ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ–‡ä»¶ã€ç›®å½•éåŽ†å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é«˜æ•ˆçš„å¤„ç†æ–‡ä»¶ã€ç›®å½•æ–¹é¢çš„äº‹æƒ…ã€‚

#### 1.è½½å…¥

è¦ä½¿ç”¨os.walk,é¦–å…ˆè¦è½½å…¥è¯¥å‡½æ•°

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•

- import os
- from os import walk

#### 2.ä½¿ç”¨

os.walkçš„å‡½æ•°å£°æ˜Žä¸º:

walk(top, topdown=True, onerror=None, followlinks=False)

å‚æ•°

- top æ˜¯ä½ æ‰€è¦éåŽ†çš„ç›®å½•çš„åœ°å€
- topdown ä¸ºçœŸï¼Œåˆ™ä¼˜å…ˆéåŽ†topç›®å½•ï¼Œå¦åˆ™ä¼˜å…ˆéåŽ†topçš„å­ç›®å½•(é»˜è®¤ä¸ºå¼€å¯)
- onerror éœ€è¦ä¸€ä¸ª callable å¯¹è±¡ï¼Œå½“walkéœ€è¦å¼‚å¸¸æ—¶ï¼Œä¼šè°ƒç”¨
- followlinks å¦‚æžœä¸ºçœŸï¼Œåˆ™ä¼šéåŽ†ç›®å½•ä¸‹çš„å¿«æ·æ–¹å¼(linux ä¸‹æ˜¯ symbolic link)å®žé™…æ‰€æŒ‡çš„ç›®å½•(é»˜è®¤å…³é—­)

os.walk çš„è¿”å›žå€¼æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨(**generator**),ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸æ–­çš„éåŽ†å®ƒï¼Œæ¥èŽ·å¾—æ‰€æœ‰çš„å†…å®¹ã€‚

æ¯æ¬¡éåŽ†çš„å¯¹è±¡éƒ½æ˜¯è¿”å›žçš„æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„(root,dirs,files)

- root æ‰€æŒ‡çš„æ˜¯å½“å‰æ­£åœ¨éåŽ†çš„è¿™ä¸ªæ–‡ä»¶å¤¹çš„æœ¬èº«çš„åœ°å€
- dirs æ˜¯ä¸€ä¸ª list ï¼Œå†…å®¹æ˜¯è¯¥æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰çš„ç›®å½•çš„åå­—(ä¸åŒ…æ‹¬å­ç›®å½•)
- files åŒæ ·æ˜¯ list , å†…å®¹æ˜¯è¯¥æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰çš„æ–‡ä»¶(ä¸åŒ…æ‹¬å­ç›®å½•)

å¦‚æžœtopdown å‚æ•°ä¸ºçœŸï¼Œwalk ä¼šéåŽ†topæ–‡ä»¶å¤¹ï¼Œä¸Žtopæ–‡ä»¶å¤¹ä¸­æ¯ä¸€ä¸ªå­ç›®å½•ã€‚

ä¸¾ä¸ªä¾‹å­

å¦‚æžœæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„æ–‡ä»¶ç»“æž„:



```css
      a ->   b   ->   1.txt,  2.txt
             c   ->   3.txt
             d   ->   
           4.txt
           5.txt
```



```bash
for (root, dirs, files) in os.walk('a'):
    #ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œå½“å‰éåŽ†ç›®å½•ä¸º a
    æ‰€ä»¥ root == 'a'
         dirs == [ 'b', 'c', 'd']
         files == [ '4.txt', '5.txt']
    
    ã€‚ã€‚ã€‚

    # æŽ¥ç€éåŽ† dirs ä¸­çš„æ¯ä¸€ä¸ªç›®å½•
    b:  root  = 'a\\b'
        dirs  = []
        files = [ '1.txt', '2.txt']
    
    # dirsä¸ºç©ºï¼Œè¿”å›ž
    # éåŽ†c
    c:  root  = 'a\\c'
        dirs  = []
        files = [ '3.txt' ]
    
    PS : å¦‚æžœæƒ³èŽ·å–æ–‡ä»¶çš„å…¨è·¯å¾„ï¼Œåªéœ€è¦ 
    for f in files:
        path = os.path.join(root,f)
    
    # éåŽ†d
    d:  root  = 'a\\b'
        dirs  = []
        files = []

    éåŽ†å®Œæ¯•ï¼Œé€€å‡ºå¾ªçŽ¯
```

#### 3.ç®€å•çš„ä¾‹å­

ä¿æŒç›®å½• a çš„ç›®å½•ç»“æž„ï¼Œåœ¨ b ä¸­åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹,å¹¶æŠŠaä¸­æ‰€æœ‰çš„æ–‡ä»¶åŠ ä¸ŠåŽç¼€ _bak

```csharp
import os

Root = 'a'
Dest = 'b'

for (root, dirs, files) in os.walk(Root):
    new_root = root.replace(Root, Dest, 1)
    if not os.path.exists(new_root):
        os.mkdir(new_root)
    
    for d in dirs:
        d = os.path.join(new_root, d)
        if not os.path.exists(d):
            os.mkdir(d)
    
    for f in files:
        # æŠŠæ–‡ä»¶ååˆ†è§£ä¸º æ–‡ä»¶å.æ‰©å±•å
        # åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ ä¸€ä¸ª filterï¼Œè¿‡æ»¤æŽ‰ä¸æƒ³å¤åˆ¶çš„æ–‡ä»¶ç±»åž‹ï¼Œæˆ–è€…æ–‡ä»¶å
        (shotname, extension) = os.path.splitext(f)
        # åŽŸæ–‡ä»¶çš„è·¯å¾„
        old_path = os.path.join(root, f)
        new_name = shotname + '_bak' + extension
        # æ–°æ–‡ä»¶çš„è·¯å¾„
        new_path = os.path.join(new_root, new_name)
        try:
            # å¤åˆ¶æ–‡ä»¶
            open(new_path, 'wb').write(open(old_path, 'rb').read())
        except IOError as e:
            print(e)
```



### 4.5 os.sep

pythonæ˜¯è·¨å¹³å°çš„ã€‚åœ¨Windowsä¸Šï¼Œæ–‡ä»¶çš„è·¯å¾„åˆ†éš”ç¬¦æ˜¯'\'ï¼Œåœ¨Linuxä¸Šæ˜¯'/'ã€‚

ä¸ºäº†è®©ä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸Šéƒ½èƒ½è¿è¡Œï¼Œé‚£ä¹ˆè·¯å¾„åº”è¯¥å†™'\'è¿˜æ˜¯'/'å‘¢ï¼Ÿ

ä½¿ç”¨os.sepçš„è¯ï¼Œå°±ä¸ç”¨è€ƒè™‘è¿™ä¸ªäº†ï¼Œos.sepæ ¹æ®ä½ æ‰€å¤„çš„å¹³å°ï¼Œè‡ªåŠ¨é‡‡ç”¨ç›¸åº”çš„åˆ†éš”ç¬¦å·ã€‚

ä¸¾ä¾‹

Linuxä¸‹ä¸€ä¸ªè·¯å¾„ï¼Œ/usr/share/python,é‚£ä¹ˆä¸Šé¢çš„os.sepå°±æ˜¯â€˜/â€™

windowsä¸‹ä¸€ä¸ªè·¯å¾„ï¼ŒCï¼š\Users\Public\Desktop,é‚£ä¹ˆä¸Šé¢çš„os.sepå°±æ˜¯â€˜\â€™.

data_dir = os.sep.join(['hello', 'world'])



#### 4.5.1 join( )

join( )ï¼šè¿žæŽ¥å­—ç¬¦ä¸²æ•°ç»„ã€‚å°†å­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨ä¸­çš„å…ƒç´ ä»¥æŒ‡å®šçš„å­—ç¬¦ï¼ˆåˆ†éš”ç¬¦ï¼‰è¿žæŽ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²

è¯­æ³•ï¼š

'sep'.join(seq)

å‚æ•°è¯´æ˜Žï¼š

sepï¼šåˆ†éš”ç¬¦ã€‚å¯ä»¥ä¸ºç©º

seqï¼šè¦è¿žæŽ¥çš„å…ƒç´ åºåˆ—ã€å­—ç¬¦ä¸²ã€å…ƒç»„ã€å­—å…¸

ä¸Šé¢çš„è¯­æ³•å³ï¼šä»¥sepä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†seqæ‰€æœ‰çš„å…ƒç´ åˆå¹¶æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²

è¿”å›žå€¼ï¼šè¿”å›žä¸€ä¸ªä»¥åˆ†éš”ç¬¦sepè¿žæŽ¥å„ä¸ªå…ƒç´ åŽç”Ÿæˆçš„å­—ç¬¦ä¸²



os.path.join()

è¯­æ³•ï¼šos.path.join(path1[,path2[,.........]])

è¿”å›žå€¼ï¼šå°†å¤šä¸ªè·¯å¾„ç»„åˆåŽè¿”å›ž

æ³¨ï¼šç¬¬ä¸€ä¸ªç»å¯¹å€¼è·¯å¾„ä¹‹å‰çš„å‚æ•°å°†è¢«å¿½ç•¥



```
#å¯¹åºåˆ—è¿›è¡Œæ“ä½œï¼ˆåˆ†åˆ«ä½¿ç”¨' 'ä¸Ž':'ä½œä¸ºåˆ†éš”ç¬¦ï¼‰
>>> seq1 = ['hello','good','boy','doiido']
>>> print ' '.join(seq1)
hello good boy doiido
>>> print ':'.join(seq1)
hello:good:boy:doiido
```

```
#å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œ
>>> seq2 = "hello good boy doiido"
>>> print ':'.join(seq2)
h:e:l:l:o: :g:o:o:d: :b:o:y: :d:o:i:i:d:o
```

```
#å¯¹å…ƒç»„è¿›è¡Œæ“ä½œ
>>> seq3 = ('hello','good','boy','doiido')
>>> print ':'.join(seq3)
hello:good:boy:doiido
```

```
#å¯¹å­—å…¸è¿›è¡Œæ“ä½œ
>>> seq4 = {'hello':1,'good':2,'boy':3,'doiido':4}
>>> print ':'.join(seq4)
boy:good:doiido:hello
```

```
#åˆå¹¶ç›®å½•
>>> import os
>>> os.path.join('/hello/','good/boy/','doiido')
```

